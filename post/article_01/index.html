<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/xiaoxiauwu.github.io\/",
  "author": {
    "@type": "Person",
    "name": "XiaoXia",
    
    "image": "https://xiaoxiauwu.github.io/images/avatar.jpg"
    
  },
  "name":"小夏の个人blog",
  "description":"",
  "url":"https:\/\/xiaoxiauwu.github.io\/post\/article_01\/",
  "keywords":"[tech, C\u002b\u002b, python, study]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.121.2 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="XiaoXia">
<meta name="keywords" content="tech, C&#43;&#43;, python, study">
<meta name="description" content="">


<meta property="og:description" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="ACM模版集">
<meta name="twitter:title" content="ACM模版集">
<meta property="og:url" content="https://xiaoxiauwu.github.io/post/article_01/">
<meta property="twitter:url" content="https://xiaoxiauwu.github.io/post/article_01/">
<meta property="og:site_name" content="小夏の个人blog">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2024-01-18T08:26:56">
  
  
    <meta property="article:modified_time" content="2024-01-18T08:26:56">
  
  
  
    
      <meta property="article:section" content="ACM">
    
      <meta property="article:section" content="算法">
    
  
  
    
      <meta property="article:tag" content="c&#43;&#43;">
    
      <meta property="article:tag" content="模版">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://xiaoxiauwu.github.io/images/avatar.jpg">
  <meta property="twitter:image" content="https://xiaoxiauwu.github.io/images/avatar.jpg">




  <meta property="og:image" content="https://s11.ax1x.com/2024/01/18/pFkTph6.jpg">
  <meta property="twitter:image" content="https://s11.ax1x.com/2024/01/18/pFkTph6.jpg">


  <meta property="og:image" content="https://xiaoxiauwu.github.io/images/cover.jpg">
  <meta property="twitter:image" content="https://xiaoxiauwu.github.io/images/cover.jpg">


    <title>ACM模版集</title>

    <link rel="icon" href="https://xiaoxiauwu.github.io/favicon.png">
    

    

    <link rel="canonical" href="https://xiaoxiauwu.github.io/post/article_01/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://xiaoxiauwu.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://xiaoxiauwu.github.io/" aria-label="Go to homepage">小夏の个人blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://xiaoxiauwu.github.io/#about" aria-label="Open the link: /#about">
    
    
    
      
        <img class="header-picture" src="https://xiaoxiauwu.github.io/images/avatar.jpg" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://xiaoxiauwu.github.io/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://xiaoxiauwu.github.io/images/avatar.jpg" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">XiaoXia</h4>
        
          <h5 class="sidebar-profile-bio">憧憬着未来却虚度着当下，到头来自己也只是一片空虚吧<strong>LIVE IN THE MOMENT</strong></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaoxiauwu.github.io/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaoxiauwu.github.io/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaoxiauwu.github.io/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaoxiauwu.github.io/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaoxiauwu.github.io/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/Xiaoxiauwu" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              post-header-cover--full"
       style="background-image:url('https://s11.ax1x.com/2024/01/18/pFkTph6.jpg')"
       data-behavior="5">
    
      <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title">
      ACM模版集
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2024-01-18T08:26:56&#43;08:00">
        
  January 18, 2024

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://xiaoxiauwu.github.io/categories/acm">ACM</a>, 
    
      <a class="category-link" href="https://xiaoxiauwu.github.io/categories/%e7%ae%97%e6%b3%95">算法</a>
    
  

  </div>

</div>
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaIn
               hasCoverCaption">
        <article class="post" id="top">
          
            <span class="post-header-cover-caption caption">别看了，多打俩题再说</span>
          
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <!-- raw HTML omitted -->
<h1 id="-cpggの模版集">| cpggの模版集</h1>
<h3 id="这道题可以打表吗">这道题可以打表吗?</h3>
<h3 id="有必要关longlong吗">有必要关longlong吗?</h3>
<h3 id="ios开了吗">IOS开了吗?</h3>
<h3 id="数据范围真的开够了吗">数据范围真的开够了吗?</h3>
<h3 id="测测最小样例和最大样例">测测最小样例和最大样例</h3>
<h1 id="头部">头部</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//#include&lt;bits/stdc++.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include&lt;iostream&gt; &lt;iomanip&gt; &lt;vector&gt; &lt;cmath&gt; &lt;cstring&gt; &lt;stack&gt; &lt;map&gt; &lt;queue&gt;    &lt;algorithm&gt; &lt;functional&gt; &lt;bitset&gt; &lt;random&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define PQ priority_queue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> i64;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//#pragma GCC optimize(1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//#pragma GCC optimize(2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//#pragma GCC optimize(3,&#34;Ofast&#34;,&#34;inline&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define IOS std::ios_base::sync_with_stdio(false), std::cin.tie(0);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> IOS <span style="color:#f92672">=</span> [] {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>ios_base<span style="color:#f92672">::</span>sync_with_stdio(<span style="color:#ae81ff">0</span>), std<span style="color:#f92672">::</span>cin.tie(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//dev : 工具 -&gt; 编译选项 -&gt; &#34;-std=c++14&#34; -&gt; 打勾 -&gt; 应用 -&gt; ctrl+n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//小心div是关键字
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define count(x) __builtin_popcount(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// Rope
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;bits/extc++.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> __gnu_cxx; 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define pb __gnu_pbds </span><span style="color:#75715e">// 这个是pbds的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 这些都要求g++编译器, clang++不支持
</span></span></span></code></pre></div><!-- raw HTML omitted -->
<p>[TOC]</p>
<h1 id="1-数学">1, 数学</h1>
<h2 id="1-1-大质数表">1-1 大质数表</h2>
<p><img src="C:%5CUsers%5C86178%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230119124801993.png" alt="image-20230119124801993"></p>
<p><img src="C:%5CUsers%5C86178%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230119124818295.png" alt="image-20230119124818295"></p>
<p><img src="C:%5CUsers%5C86178%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230119124832156.png" alt="image-20230119124832156"></p>
<p><img src="C:%5CUsers%5C86178%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230119124844916.png" alt="image-20230119124844916"></p>
<p><img src="cp_acm_%E6%A8%A1%E6%9D%BF.assets/image-20230712103538296.png" alt="image-20230712103538296"></p>
<p><strong>1e9+21,  1e9+33 , 1e9+87, 1e9+93, 1e9+97</strong>, 质数 !</p>
<p>$w(n)$ 指质因数数量, $d(n)$ 指约数数量</p>
<p><strong>常数 e = 2.7182818284590452353602874713526624977572</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span> <span style="color:#75715e">// 18位素数：154590409516822759
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#75715e">// 19位素数：2305843009213693951 (梅森素数)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#75715e">// 19位素数：4384957924686954497
</span></span></span></code></pre></div><h2 id="1-2-米勒罗宾判素数">1-2 米勒罗宾判素数</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">维基百科 :
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">n &lt; 4e9, prime = [2, 7, 61]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">n &lt; 3e14, prime = [2, 3, 5, 7, 11, 13, 17]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">n &lt; 3e18, prime = [2, 3, 5, 7, 11, 13, 17, 19, 23]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">n &lt; 3e23, prime = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">constexpr</span> <span style="color:#66d9ef">int</span> prime[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">23</span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 快速乘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>i64 <span style="color:#a6e22e">mulp</span>(i64 x, i64 y, <span style="color:#66d9ef">const</span> i64 <span style="color:#f92672">&amp;</span>mod) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (__int128)x <span style="color:#f92672">*</span> y <span style="color:#f92672">%</span> mod; <span style="color:#75715e">// 还是尽量用__int128, 龟速乘实在是太慢了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// i64 ans = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// for (; y; y &gt;&gt;= 1) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     if (y &amp; 1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//         ans = (ans + x) % mod;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     x = (x + x) % mod;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// return ans;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>i64 <span style="color:#a6e22e">powp</span>(i64 a, i64 mi, <span style="color:#66d9ef">const</span> i64 <span style="color:#f92672">&amp;</span>mod) {
</span></span><span style="display:flex;"><span>    i64 ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; mi; mi <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (mi <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">=</span> mulp(ans, a, mod);
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">=</span> mulp(a, a, mod);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">isp</span>(i64 v) { <span style="color:#75715e">// 判断v是不是质数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span> or v <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span> and v <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>    i64 s <span style="color:#f92672">=</span> v <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>(s <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>        s <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> x : prime) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">==</span> x)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>        i64 t <span style="color:#f92672">=</span> s, m <span style="color:#f92672">=</span> powp(x, s, v);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (t <span style="color:#f92672">!=</span> v <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> and m <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span> and m <span style="color:#f92672">!=</span> v <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            m <span style="color:#f92672">=</span> mulp(m, m, v), t <span style="color:#f92672">&lt;&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (m <span style="color:#f92672">!=</span> v <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> and <span style="color:#f92672">!</span>(t <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-3-取随机数">1-3 取随机数</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>mt19937 myrand(time(<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">rd</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r){
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>uniform_int_distribution<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span>(l, r)(myrand);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//得到[l,r]之间的均匀随机数
</span></span></span></code></pre></div><h2 id="1-4-pollard-rho-算法">1-4 Pollard rho 算法</h2>
<p>如果 $n$ 是质数 $(Miller-Rabbin判)$ 返回 $n$</p>
<p>否则返回 $n$ 的随机一个 $[2,n-1]$ 的因子</p>
<p>复杂度理论 $O(n^{\frac{1}{4}}\log n)$     但实际跑得快, 可以按 $O(n^{\frac{1}{4}})$ 算</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 使用前提: 把上面的米勒罗宾抄下来
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>i64 <span style="color:#a6e22e">gcd</span>(i64 a, i64 b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> b <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> a : gcd(b, a <span style="color:#f92672">%</span> b);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>mt19937 myrand(time(<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>i64 <span style="color:#a6e22e">rd</span>(i64 l, i64 r) { <span style="color:#75715e">// 注意这里是i64的随机数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>uniform_int_distribution<span style="color:#f92672">&lt;</span>i64<span style="color:#f92672">&gt;</span>(l, r)(myrand);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>i64 <span style="color:#a6e22e">Pollard_Rho</span>(i64 n) { <span style="color:#75715e">// 返回 n 的随机一个[2, n-1]内的因子, 或者判定是质数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (isp(n)) <span style="color:#75715e">// Miller-Rabbin 判质数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> n; <span style="color:#75715e">// 如果 n 是质数直接返回 n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> (true) {
</span></span><span style="display:flex;"><span>        i64 c <span style="color:#f92672">=</span> rd(<span style="color:#ae81ff">1</span>, n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> f <span style="color:#f92672">=</span> [<span style="color:#f92672">=</span>](i64 x) { <span style="color:#66d9ef">return</span> (mulp(x, x, n) <span style="color:#f92672">+</span> c) <span style="color:#f92672">%</span> n; };
</span></span><span style="display:flex;"><span>        i64 t <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, p <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, q;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">do</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">128</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                t <span style="color:#f92672">=</span> f(t), r <span style="color:#f92672">=</span> f(f(r));
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (t <span style="color:#f92672">==</span> r <span style="color:#f92672">||</span> (q <span style="color:#f92672">=</span> mulp(p, std<span style="color:#f92672">::</span>abs(t <span style="color:#f92672">-</span> r), n)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                p <span style="color:#f92672">=</span> q;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            i64 d <span style="color:#f92672">=</span> gcd(p, n);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (d <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> d;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">while</span> (t <span style="color:#f92672">!=</span> r);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-5-求所有约数">1-5 求所有约数</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> div; <span style="color:#75715e">// div是关键字
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getdiv</span>(<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    div.clear();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    div.push_back(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> pr <span style="color:#f92672">=</span> v[x];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, r <span style="color:#f92672">=</span> div.size();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (x <span style="color:#f92672">%</span> pr <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">/=</span> pr;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> l; k <span style="color:#f92672">&lt;</span> r; k<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                div.push_back(div[k] <span style="color:#f92672">*</span> pr);
</span></span><span style="display:flex;"><span>            l <span style="color:#f92672">=</span> r, r <span style="color:#f92672">=</span> div.size();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-6-varphix-和-mu-x">1-6 $\varphi(x)$ 和 $\mu (x)$</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> phi[N], mu[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">euler</span>(){
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>iota(phi, phi <span style="color:#f92672">+</span> N, <span style="color:#ae81ff">0</span>), mu[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> N; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> i; j <span style="color:#f92672">&lt;</span> N; j <span style="color:#f92672">+=</span> i)
</span></span><span style="display:flex;"><span>			phi[j] <span style="color:#f92672">-=</span> phi[i], mu[j] <span style="color:#f92672">-=</span> mu[i];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-7-指数方程">1-7 指数方程</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">exeq</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> g) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a ^ n = g (mod p) 求最小的n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> sq <span style="color:#f92672">=</span> sqrt(p) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>unordered_map<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> mp;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">30</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> sq; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>mp.count(b))
</span></span><span style="display:flex;"><span>            mp[b] <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> b <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> invb <span style="color:#f92672">=</span> powp(b, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>), tar <span style="color:#f92672">=</span> g;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">*</span> sq <span style="color:#f92672">&lt;=</span> p; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (mp.count(tar))
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(ans, mp[tar] <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> sq);
</span></span><span style="display:flex;"><span>        tar <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> tar <span style="color:#f92672">*</span> invb <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ans <span style="color:#f92672">==</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>        ans <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#75715e">// 无解
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-8-线性逆元">1-8 线性逆元</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>inv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    inv[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> (p <span style="color:#f92672">-</span> p <span style="color:#f92672">/</span> i) <span style="color:#f92672">*</span> inv[p <span style="color:#f92672">%</span> i] <span style="color:#f92672">%</span> p;
</span></span></code></pre></div><h2 id="1-9-排列组合">1-9 排列组合</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">powp</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> mi) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; mi; mi <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> a <span style="color:#f92672">%</span> p)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (mi <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> ans <span style="color:#f92672">*</span> a <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> jc[N], ijc[N], Capps <span style="color:#f92672">=</span> [] {
</span></span><span style="display:flex;"><span>    jc[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> ijc[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> N; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        jc[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> jc[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> i <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    ijc[N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> powp(jc[N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], p <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        ijc[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> ijc[i] <span style="color:#f92672">*</span> i <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}(); <span style="color:#75715e">// O(n) 预处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">A</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">&lt;</span> b <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> jc[a] <span style="color:#f92672">*</span> ijc[a <span style="color:#f92672">-</span> b] <span style="color:#f92672">%</span> p);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">C</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">&lt;</span> b <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> jc[a] <span style="color:#f92672">*</span> ijc[a <span style="color:#f92672">-</span> b] <span style="color:#f92672">%</span> p <span style="color:#f92672">*</span> ijc[b] <span style="color:#f92672">%</span> p);
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">// O(1) 查询
</span></span></span></code></pre></div><h2 id="1-10-原根">1-10 原根</h2>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>其中$\phi(x)$是欧拉函数, 以下代码可以一次性求 $10^6$ 以下的数的原根</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getGenRoot</span>(<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> phi <span style="color:#f92672">=</span> (x <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> x <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">:</span> x <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> g <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;; g<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> ok <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, h <span style="color:#f92672">=</span> g, i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (; h <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            h <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> h <span style="color:#f92672">*</span> g <span style="color:#f92672">%</span> x;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> phi)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> g;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>​	<strong>$10^9+7$ 的原根是 $5$</strong></p>
<h2 id="1-11-ntt">1-11 NTT</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define VI std::vector&lt;int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">//唯一需要调的参数是LG
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> LG <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>; <span style="color:#75715e">//内存参数，约为log(多项式长度)      LG==21 -&gt; 30MB (注意调节)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> LG);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> p <span style="color:#f92672">=</span> <span style="color:#ae81ff">998244353</span>; <span style="color:#75715e">// p+p不能溢出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">mul</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> b <span style="color:#f92672">%</span> p; <span style="color:#75715e">// int
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">powp</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> p <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; b; b <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span>, a <span style="color:#f92672">=</span> mul(a, a))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (b <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> mul(c, a);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> c;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> w[r], ny[r], Capps <span style="color:#f92672">=</span> [] {
</span></span><span style="display:flex;"><span>    w[r <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> s <span style="color:#f92672">=</span> powp(<span style="color:#ae81ff">3</span>, (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> r);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> r <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> r; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>        w[i] <span style="color:#f92672">=</span> mul(s, w[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> r <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>; <span style="color:#f92672">--</span>i)
</span></span><span style="display:flex;"><span>        w[i] <span style="color:#f92672">=</span> w[i <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>    ny[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>; i <span style="color:#f92672">&lt;</span> r; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        ny[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> (p <span style="color:#f92672">-</span> p <span style="color:#f92672">/</span> i) <span style="color:#f92672">*</span> ny[p <span style="color:#f92672">%</span> i] <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dft</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> n <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>; k; k <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> k)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> k; <span style="color:#f92672">++</span>j) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> t <span style="color:#f92672">=</span> a[i <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> k];
</span></span><span style="display:flex;"><span>                a[i <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> k] <span style="color:#f92672">=</span> mul(a[i <span style="color:#f92672">+</span> j] <span style="color:#f92672">-</span> t <span style="color:#f92672">+</span> p, w[k <span style="color:#f92672">+</span> j]);
</span></span><span style="display:flex;"><span>                a[i <span style="color:#f92672">+</span> j] <span style="color:#f92672">=</span> (a[i <span style="color:#f92672">+</span> j] <span style="color:#f92672">+</span> t) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">idft</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; k <span style="color:#f92672">&lt;</span> n; k <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> k)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> k; <span style="color:#f92672">++</span>j) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> u <span style="color:#f92672">=</span> a[i <span style="color:#f92672">+</span> j];
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> v <span style="color:#f92672">=</span> mul(a[i <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> k], w[j <span style="color:#f92672">+</span> k]);
</span></span><span style="display:flex;"><span>                a[i <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> k] <span style="color:#f92672">=</span> (u <span style="color:#f92672">+</span> p <span style="color:#f92672">-</span> v) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>                a[i <span style="color:#f92672">+</span> j] <span style="color:#f92672">=</span> (u <span style="color:#f92672">+</span> v) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>        a[i] <span style="color:#f92672">=</span> mul(a[i], p <span style="color:#f92672">-</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> n);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>reverse(a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, a <span style="color:#f92672">+</span> n);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>VI <span style="color:#66d9ef">operator</span><span style="color:#f92672">*</span>(VI a, VI b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> a.size() <span style="color:#f92672">+</span> b.size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> s <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>__lg(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    a.resize(s);
</span></span><span style="display:flex;"><span>    b.resize(s);
</span></span><span style="display:flex;"><span>    dft(a.data(), a.size());
</span></span><span style="display:flex;"><span>    dft(b.data(), b.size());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> s; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>        a[i] <span style="color:#f92672">=</span> mul(a[i], b[i]);
</span></span><span style="display:flex;"><span>    idft(a.data(), a.size());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a.resize(n), a;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//用法：引入两个VI f和g, 直接乘f*g返回二者乘积的VI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//注意vector表示多项式中，第0项表示常数项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//这里的模数只能是998244353或者1004535809
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>VI <span style="color:#a6e22e">inv</span>(<span style="color:#66d9ef">const</span> VI <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 常数项必须是 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> a.size();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {powp(a[<span style="color:#ae81ff">0</span>], p <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>)};
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    VI a2(a.begin(), a.begin() <span style="color:#f92672">+</span> (n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    VI b <span style="color:#f92672">=</span> inv(a2);
</span></span><span style="display:flex;"><span>    VI c <span style="color:#f92672">=</span> a <span style="color:#f92672">*</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>i : c)
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> i) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> c <span style="color:#f92672">*</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> c.resize(n), c;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>VI <span style="color:#a6e22e">ln</span>(<span style="color:#66d9ef">const</span> VI <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 常数项必须是 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> a.size();
</span></span><span style="display:flex;"><span>    VI b(n, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        b[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">*</span> a[i] <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">=</span> b <span style="color:#f92672">*</span> inv(a);
</span></span><span style="display:flex;"><span>    b.resize(n);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        b[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> b[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> ny[i] <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    b[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> b;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>VI <span style="color:#a6e22e">exp</span>(<span style="color:#66d9ef">const</span> VI <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> a.size();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {<span style="color:#ae81ff">1</span>};
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    VI a2(a.begin(), a.begin() <span style="color:#f92672">+</span> (n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    VI b <span style="color:#f92672">=</span> exp(a2);
</span></span><span style="display:flex;"><span>    b.resize(n);
</span></span><span style="display:flex;"><span>    VI c <span style="color:#f92672">=</span> ln(b);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        c[i] <span style="color:#f92672">=</span> (a[i] <span style="color:#f92672">-</span> c[i] <span style="color:#f92672">+</span> p) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> c <span style="color:#f92672">*</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> c.resize(n), c;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-12-fft">1-12 FFT</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//常常要开longlong
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">double</span> ld; <span style="color:#75715e">// double 就够了,10^15也没必要开longdouble
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define pdd std::pair&lt;ld, ld&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define vd std::vector&lt;ld&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define VI std::vector&lt;int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define x first
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define y second
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">//调参
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> EX <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>; <span style="color:#75715e">// 21 能支持俩1e6多项式的乘法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> ld pi <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.1415926535897932384626433832795028841971</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Complex number
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pdd <span style="color:#66d9ef">operator</span><span style="color:#f92672">+</span>(<span style="color:#66d9ef">const</span> pdd <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pdd <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a.x <span style="color:#f92672">+</span> b.x, a.y <span style="color:#f92672">+</span> b.y};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pdd <span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>(<span style="color:#66d9ef">const</span> pdd <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pdd <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a.x <span style="color:#f92672">-</span> b.x, a.y <span style="color:#f92672">-</span> b.y};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pdd <span style="color:#66d9ef">operator</span><span style="color:#f92672">*</span>(<span style="color:#66d9ef">const</span> pdd <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pdd <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a.x <span style="color:#f92672">*</span> b.x <span style="color:#f92672">-</span> a.y <span style="color:#f92672">*</span> b.y, a.x <span style="color:#f92672">*</span> b.y <span style="color:#f92672">+</span> a.y <span style="color:#f92672">*</span> b.x};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> l, limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, r[<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> EX];
</span></span><span style="display:flex;"><span>pdd Wn[<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> EX];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">FFT</span>(pdd <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> opt) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> limit; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&lt;</span> r[i])
</span></span><span style="display:flex;"><span>            swap(a[i], a[r[i]]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; mid <span style="color:#f92672">&lt;</span> limit; mid <span style="color:#f92672">&lt;&lt;=</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> mid; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            Wn[i] <span style="color:#f92672">=</span> {cosl(pi <span style="color:#f92672">*</span> i <span style="color:#f92672">/</span> mid), opt <span style="color:#f92672">*</span> sinl(pi <span style="color:#f92672">*</span> i <span style="color:#f92672">/</span> mid)};
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> R <span style="color:#f92672">=</span> mid <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> limit; j <span style="color:#f92672">+=</span> R) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; k <span style="color:#f92672">&lt;</span> mid; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                pdd x <span style="color:#f92672">=</span> a[j <span style="color:#f92672">+</span> k], y <span style="color:#f92672">=</span> Wn[k] <span style="color:#f92672">*</span> a[j <span style="color:#f92672">+</span> mid <span style="color:#f92672">+</span> k];
</span></span><span style="display:flex;"><span>                a[j <span style="color:#f92672">+</span> k] <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> y;
</span></span><span style="display:flex;"><span>                a[j <span style="color:#f92672">+</span> mid <span style="color:#f92672">+</span> k] <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> y;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">精度较低的写法,记得要把Wn数组删了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">void FFT(pdd *a, int opt) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    for (int i = 0; i &lt; limit; i++)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        if (i &lt; r[i])
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            swap(a[i], a[r[i]]);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    for (int mid = 1; mid &lt; limit; mid &lt;&lt;= 1) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        pdd Wn = {cos(pi / mid), opt * sin(pi / mid)};
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        for (int R = mid &lt;&lt; 1, j = 0; j &lt; limit; j += R) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            pdd w = {1, 0};
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            for (int k = 0; k &lt; mid; k++, w = w * Wn) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                pdd x = a[j + k], y = w * a[j + mid + k];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                a[j + k] = x + y;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                a[j + mid + k] = x - y;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>VI <span style="color:#66d9ef">operator</span><span style="color:#f92672">*</span>(<span style="color:#66d9ef">const</span> VI <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> VI <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> a.size(), m <span style="color:#f92672">=</span> b.size();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//要注意结果int装不装的下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    VI <span style="color:#a6e22e">ans</span>(n <span style="color:#f92672">+</span> m <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">--</span>, m<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>    limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (limit <span style="color:#f92672">&lt;=</span> n <span style="color:#f92672">+</span> m)
</span></span><span style="display:flex;"><span>        limit <span style="color:#f92672">&lt;&lt;=</span> <span style="color:#ae81ff">1</span>, l<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> limit; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        r[i] <span style="color:#f92672">=</span> (r[i <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">|</span> ((i <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;&lt;</span> (l <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//---可换---------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    pdd <span style="color:#f92672">*</span>c <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> pdd[limit]();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        c[i].x <span style="color:#f92672">=</span> a[i];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> m; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        c[i].y <span style="color:#f92672">=</span> b[i];
</span></span><span style="display:flex;"><span>    FFT(c, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> limit; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        c[i] <span style="color:#f92672">=</span> c[i] <span style="color:#f92672">*</span> c[i];
</span></span><span style="display:flex;"><span>    FFT(c, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> n <span style="color:#f92672">+</span> m; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        ans[i] <span style="color:#f92672">=</span> c[i].y <span style="color:#f92672">/</span> (limit <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span>[] c;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//---可换---------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//如果要求浮点数卷积,可以将&#34;可换&#34;区间换成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	pdd*c=new pdd[limit]();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	pdd*v=new pdd[limit]();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	for(int i=0; i&lt;=n; i++) c[i].x=a[i];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	for(int i=0; i&lt;=m; i++) v[i].x=b[i];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	FFT(c,1); FFT(v,1);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	for(int i=0; i&lt;limit; i++)c[i]=c[i]*v[i];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	FFT(c,-1);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	for(int i=0; i&lt;=n+m; i++) ans[i]=c[i].x/limit;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	delete[]c,v;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	//注意要把VI都换成vd
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//用法：引入两个VI f和g, 直接乘f*g返回二者乘积的VI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//注意vector表示多项式中，第0项表示常数项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//注意卷积结果不要太大，太大的话得考虑开longlong
</span></span></span></code></pre></div><h2 id="1-13分治fft">1-13分治FFT</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> f[N], g[N];
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> g, f[0] 已知
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> f[i] = sum(f[j]*g[k])
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      j+k≤i-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">divide</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">==</span> r){
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 如果式子复杂就在这里进行真值转化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    divide(l, mid);
</span></span><span style="display:flex;"><span>    VI a(mid <span style="color:#f92672">-</span> l <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>), b(r <span style="color:#f92672">-</span> l <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> l; i <span style="color:#f92672">&lt;=</span> mid; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        a[i <span style="color:#f92672">-</span> l] <span style="color:#f92672">=</span> f[i];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> l; i <span style="color:#f92672">&lt;=</span> r; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        b[i <span style="color:#f92672">-</span> l] <span style="color:#f92672">=</span> g[i <span style="color:#f92672">-</span> l];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> c <span style="color:#f92672">=</span> a <span style="color:#f92672">*</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> r; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        f[i] <span style="color:#f92672">=</span> (f[i] <span style="color:#f92672">+</span> c[i <span style="color:#f92672">-</span> l <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    divide(mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-14-扩展gcd">1-14 扩展gcd</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">exgcd</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>x, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>y) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>b) <span style="color:#66d9ef">return</span> (x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, a);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> g <span style="color:#f92672">=</span> exgcd(b, a <span style="color:#f92672">%</span> b, y, x);
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">-=</span> a <span style="color:#f92672">/</span> b <span style="color:#f92672">*</span> x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> g;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>对于方程 $ax+by=c$ , 调用 **exgcd **, 求出 $x_0$ 和 $y_0$ 使得 $ax_0+by_0=\gcd(a, b)$</p>
<p>则在 $\gcd(a,b)\mid c$ 的情况下有通解
$$
x = x_0 \times \frac{c}{\gcd(a, b)}+k\times \frac{b}{\gcd(a, b)}
\
y = y_0 \times \frac{c}{\gcd(a, b)}-k\times \frac{a}{\gcd(a, b)}
$$</p>
<h2 id="1-15-扩展crt中国剩余定理">1-15 扩展crt(中国剩余定理)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//n个方程 x ≡ a (mod m)  解出最小的x，无解输出-1 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//需要配合exgcd()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">excrt</span>(<span style="color:#66d9ef">const</span> VI <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> VI <span style="color:#f92672">&amp;</span>m) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, M <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, n <span style="color:#f92672">=</span> a.size();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> ok <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> a[i] <span style="color:#f92672">-</span> x, j, y;
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">%=</span> m[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) r <span style="color:#f92672">+=</span> m[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> g <span style="color:#f92672">=</span> exgcd(M, m[i], j, y);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">%</span> g) ok <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> ((__int128)j <span style="color:#f92672">*</span> r <span style="color:#f92672">/</span> g <span style="color:#f92672">%</span> (m[i] <span style="color:#f92672">/</span> g));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) j <span style="color:#f92672">+=</span> m[i] <span style="color:#f92672">/</span> g;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> lM <span style="color:#f92672">=</span> M;
</span></span><span style="display:flex;"><span>        M <span style="color:#f92672">=</span> M <span style="color:#f92672">/</span> g <span style="color:#f92672">*</span> m[i]; <span style="color:#75715e">// M=lcm(M,m[i])
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        x <span style="color:#f92672">=</span> ((__int128)j <span style="color:#f92672">*</span> lM <span style="color:#f92672">%</span> M <span style="color:#f92672">+</span> x) <span style="color:#f92672">%</span> M;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ok) <span style="color:#66d9ef">return</span> x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-16-高斯消元">1-16 高斯消元</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> ld eps <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e-9</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> N <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">gauss</span>(ld a[][N], <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> c, r;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; c <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>c) { <span style="color:#75715e">// c列r行，遍历列
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> t <span style="color:#f92672">=</span> r;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> r; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i) <span style="color:#75715e">// 寻找列主元，拿t记录
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (std<span style="color:#f92672">::</span>fabs(a[i][c]) <span style="color:#f92672">&gt;</span> std<span style="color:#f92672">::</span>fabs(a[t][c]))
</span></span><span style="display:flex;"><span>                t <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (std<span style="color:#f92672">::</span>fabs(a[t][c]) <span style="color:#f92672">&lt;</span> eps)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>; <span style="color:#75715e">// 如果列主元为0，不必考虑，当前列全为0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 交换列主元t行与当前r行的数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> c; i <span style="color:#f92672">&lt;</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>swap(a[t][i], a[r][i]);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 当前列主元已经被交换到了r行，需要从后向前进行处理，避免主对角线元素变成1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n; i <span style="color:#f92672">&gt;=</span> c; <span style="color:#f92672">--</span>i)
</span></span><span style="display:flex;"><span>            a[r][i] <span style="color:#f92672">/=</span> a[r][c];
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 列主消元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (std<span style="color:#f92672">::</span>fabs(a[i][c]) <span style="color:#f92672">&gt;</span> eps)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> n; j <span style="color:#f92672">&gt;=</span> c; <span style="color:#f92672">--</span>j)
</span></span><span style="display:flex;"><span>                    a[i][j] <span style="color:#f92672">-=</span> a[r][j] <span style="color:#f92672">*</span> a[i][c];
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">++</span>r;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">&lt;</span> n) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> r; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (std<span style="color:#f92672">::</span>fabs(a[i][n]) <span style="color:#f92672">&gt;</span> eps)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span>; <span style="color:#75715e">// 2 则无解
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;         <span style="color:#75715e">// 1 无穷多解
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 上三角阶梯型矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 直接求解即可，最后一列放置结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#f92672">--</span>i)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>j)
</span></span><span style="display:flex;"><span>            a[i][n] <span style="color:#f92672">-=</span> a[j][n] <span style="color:#f92672">*</span> a[i][j];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-17-线性基">1-17 线性基</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>i64 b[<span style="color:#ae81ff">64</span>], flag;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 线性基数组 , flag 表示线性基能不能异或出 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">insert</span>(i64 x) { <span style="color:#75715e">// 插入一个数到线性基里
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">62</span>; i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">&gt;&gt;</span> i <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>b[i]) <span style="color:#75715e">// 线性基里没有第i位的项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> b[i] <span style="color:#f92672">=</span> x, true;
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">^=</span> b[i]; <span style="color:#75715e">// 线性基里有,则异或掉第i位
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">check</span>(i64 x) { <span style="color:#75715e">// 询问线性基能不能异或出 x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">62</span>; i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">&gt;&gt;</span> i <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>b[i]) <span style="color:#75715e">// 线性基里没有第i位的项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">^=</span> b[i]; <span style="color:#75715e">// 线性基里有,则异或掉第i位
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-18-前缀线性基">1-18 前缀线性基</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 题目大概率要开long long
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> b[N][<span style="color:#ae81ff">20</span>], pos[N][<span style="color:#ae81ff">20</span>]; <span style="color:#75715e">// 20 是 std::__lg(max_value)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> x) { 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 插入第 i 项数为 x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    memcpy(b[i], b[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], <span style="color:#66d9ef">sizeof</span> b[i]); <span style="color:#75715e">// 一定要从左到右顺着插入
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    memcpy(pos[i], pos[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], <span style="color:#66d9ef">sizeof</span> pos[i]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, w <span style="color:#f92672">=</span> i; j <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; j<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">&gt;&gt;</span> j <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>b[i][j]) {
</span></span><span style="display:flex;"><span>                b[i][j] <span style="color:#f92672">=</span> x, pos[i][j] <span style="color:#f92672">=</span> w;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (pos[i][j] <span style="color:#f92672">&lt;</span> w)
</span></span><span style="display:flex;"><span>                std<span style="color:#f92672">::</span>swap(pos[i][j], w), std<span style="color:#f92672">::</span>swap(b[i][j], x);
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">^=</span> b[i][j];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">ask</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) { <span style="color:#75715e">// 询问区间[l, r]的最大异或值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 如果问第 k 小异或值记得要考虑 0 的结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>; j <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; j<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">&lt;=</span> pos[r][j])
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(ans, ans <span style="color:#f92672">^</span> b[r][j]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-19-组合数公式">1-19 组合数公式</h2>
<p>$$
C_{n}^{m-1} +C_{n}^{m} = C_{n+1}^m
\
\
m\times C_n^m = n\times C_{n-1}^{m-1}
\
\
1\times C_n^1 + 2\times C_n^2 + 3\times C_n^3 +&hellip;+n\times C_n^n = n\times 2^{n-1}
\ (由上一条定理易得)
\
\
1^2\times C_n^1 + 2^2\times C_n^2 + 3^2\times C_n^3 +&hellip;+n^2\times C_n^n = n(n+1)\times 2^{n-2}
\(仿照上一条定理证明过程, 记得把i拆成i-1+1再分开两项可证)
\
\
C_k^k+C_{k+1}^k+C_{k+2}^k+&hellip;+C_n^k=C_{n+1}^{k+1}
\(画出杨辉三角易得)
\
\
\sum_{i=0}^n (C_n^i)^2 = C_{2n}^n
\(左边n个红球,右边n个蓝球,一共取n个球, 有几种取法)
$$</p>
<h2 id="1-20-二项式反演">1-20 二项式反演</h2>
<p>$$
f(n) = \sum_{i=0}^{n}g(i) \ \ \   \Leftrightarrow \ \ \  g(n)=\sum_{i=0}^{n}(-1)^{n-i}×C_n^i×f(i) \
f(n) = \sum_{i=n}^{m}g(i) \ \ \  \Leftrightarrow  \ \ \  g(n)=\sum_{i=n}^{m}(-1)^{n-i}×C_i^n×f(i)
$$</p>
<p><strong>完全积性函数反演</strong></p>
<p><img src="cp_acm_%E6%A8%A1%E6%9D%BF.assets/image-20231009170044242.png" alt="image-20231009170044242"></p>
<h2 id="1-21-容斥原理">1-21 容斥原理</h2>
<!-- raw HTML omitted -->
<h2 id="1-22-fwt">1-22 FWT</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">+=</span> b;
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">+=</span> (a <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> p : (a <span style="color:#f92672">&gt;=</span> p <span style="color:#f92672">?</span> <span style="color:#f92672">-</span>p : <span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fwt</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>f, <span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">int</span> op, <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>conv)(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>, <span style="color:#66d9ef">int</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; a <span style="color:#f92672">&lt;</span> n; a <span style="color:#f92672">&lt;&lt;=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> a <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>, i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i <span style="color:#f92672">+=</span> b)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> i; j <span style="color:#f92672">&lt;</span> i <span style="color:#f92672">+</span> a; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                conv(f[j], f[j <span style="color:#f92672">+</span> a], op);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">opor</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">int</span> op) {
</span></span><span style="display:flex;"><span>    add(b, op <span style="color:#f92672">*</span> a);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">opand</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">int</span> op) {
</span></span><span style="display:flex;"><span>    add(a, op <span style="color:#f92672">*</span> b);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> inv2 <span style="color:#f92672">=</span> p <span style="color:#f92672">-</span> p <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">opxor</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">int</span> op) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> x <span style="color:#f92672">=</span> a, y <span style="color:#f92672">=</span> b;
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> (x <span style="color:#f92672">+</span> y) <span style="color:#f92672">%</span> p <span style="color:#f92672">*</span> (op <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> inv2) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> (x <span style="color:#f92672">-</span> y <span style="color:#f92672">+</span> p) <span style="color:#f92672">%</span> p <span style="color:#f92672">*</span> (op <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> inv2) <span style="color:#f92672">%</span> p;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="1-23-子集卷积">1-23 子集卷积</h2>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">+=</span> b;
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">+=</span> (a <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> p : (a <span style="color:#f92672">&gt;=</span> p <span style="color:#f92672">?</span> <span style="color:#f92672">-</span>p : <span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fwt</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>f, <span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">int</span> op) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> n; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&gt;&gt;</span> j <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>)	
</span></span><span style="display:flex;"><span>                add(f[i], op <span style="color:#f92672">*</span> f[i <span style="color:#f92672">^</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> j)]);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">count</span>(<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (x) x <span style="color:#f92672">-=</span> x <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>x, res<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> f[<span style="color:#ae81ff">21</span>][N], g[<span style="color:#ae81ff">21</span>][N], h[<span style="color:#ae81ff">21</span>][N];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// c[i] =  sum  a[j]*b[k]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//    (j|k=i j&amp;k=0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">subsetConv</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>c, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// input a and b , ouput c, len = 1 &lt;&lt; n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        f[count(i)][i] <span style="color:#f92672">=</span> a[i], g[count(i)][i] <span style="color:#f92672">=</span> b[i];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        fwt(f[i], n, <span style="color:#ae81ff">1</span>), fwt(g[i], n, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;=</span> n; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">+</span> j <span style="color:#f92672">&lt;=</span> n)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; k <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> n; k<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                    add(h[i <span style="color:#f92672">+</span> j][k], <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> f[i][k] <span style="color:#f92672">*</span> g[j][k] <span style="color:#f92672">%</span> p);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        fwt(h[i], n, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        c[i] <span style="color:#f92672">=</span> h[count(i)][i];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>复杂度：$O(n^2×2^n)$ n是bit数</p>
<h3 id="有趣的知识">有趣的知识</h3>
<p><strong>python 的自我打印程序</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>_<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;_=</span><span style="color:#e6db74">%r</span><span style="color:#e6db74">;print(_</span><span style="color:#e6db74">%%</span><span style="color:#e6db74">_)&#39;</span>;print(_<span style="color:#f92672">%</span>_)
</span></span></code></pre></div><!-- raw HTML omitted -->
<h1 id="2-动态规划">2, 动态规划</h1>
<h2 id="2-1-多重背包">2-1 多重背包</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>i64<span style="color:#f92672">&gt;</span> multiBag(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>array<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">&gt;&gt;&amp;</span> goods, <span style="color:#66d9ef">int</span> S) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// S 总背包大小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>i64<span style="color:#f92672">&gt;</span> f(S <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> q(S <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [v, w, m] <span style="color:#f92672">:</span> goods) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// v价值, w体积, m数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">auto</span> calc <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> j) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> f[j] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> (i <span style="color:#f92672">-</span> j) <span style="color:#f92672">/</span> w <span style="color:#f92672">*</span> v;
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> up <span style="color:#f92672">=</span> S; up <span style="color:#f92672">+</span> w <span style="color:#f92672">&gt;</span> S; up<span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> l <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, k <span style="color:#f92672">=</span> up;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> up; x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>; x <span style="color:#f92672">-=</span> w) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (; k <span style="color:#f92672">&gt;=</span> std<span style="color:#f92672">::</span>max(<span style="color:#ae81ff">0ll</span>, x <span style="color:#f92672">-</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> m <span style="color:#f92672">*</span> w); k <span style="color:#f92672">-=</span> w) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> (l <span style="color:#f92672">&lt;=</span> r and calc(x, k) <span style="color:#f92672">&gt;</span> calc(x, q[r]))
</span></span><span style="display:flex;"><span>                        r<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>                    q[<span style="color:#f92672">++</span>r] <span style="color:#f92672">=</span> k;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                f[x] <span style="color:#f92672">=</span> calc(x, q[l]);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (q[l] <span style="color:#f92672">==</span> x)
</span></span><span style="display:flex;"><span>                    l<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> f;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="2-2-基数排序">2-2 基数排序</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> B <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">radix_sort</span>(<span style="color:#66d9ef">int</span> a[], <span style="color:#66d9ef">int</span> n) { <span style="color:#75715e">// 下标从0开始
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span>[n];          <span style="color:#75715e">// 临时空间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>cnt <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span>[<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> B];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mask <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> B) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>x <span style="color:#f92672">=</span> a, <span style="color:#f92672">*</span>y <span style="color:#f92672">=</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span>; i <span style="color:#f92672">+=</span> B) { <span style="color:#75715e">// 对32位整数排序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        memset(cnt, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span> cnt);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> n; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">++</span>cnt[x[j] <span style="color:#f92672">&gt;&gt;</span> i <span style="color:#f92672">&amp;</span> mask];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> B); j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            sum <span style="color:#f92672">+=</span> cnt[j], cnt[j] <span style="color:#f92672">=</span> sum <span style="color:#f92672">-</span> cnt[j];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> n; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            y[cnt[x[j] <span style="color:#f92672">&gt;&gt;</span> i <span style="color:#f92672">&amp;</span> mask]<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> x[j];
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>swap(x, y);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span>[] cnt;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">delete</span>[] b;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="2-3-四边形不等式">2-3 四边形不等式</h2>
<p>对于 $dp[i][j] = \min_{i\le k\le j}(dp[i][k], dp[k+1][j]) + w[i][j]$ 的区间dp 。</p>
<p>不妨设在 $dp[i][j]$ 里取最优的 $k$ 为 $pos[i][j]$ 。</p>
<p>要求两个条件 ：</p>
<ul>
<li>对于 $L\le l \le r\le R$ 有 $w[l][r] \le w[L][R]$</li>
<li>对于 $L\le l \le r\le R$ 有 $w[L][r]+w[l][R] \le w[l][r]+w[L][R]$</li>
</ul>
<p>于是有这样的性质：</p>
<ul>
<li>$pos[i][j-1] \le pos[i][j] \le pos[i+1][j]$</li>
</ul>
<p>于是得到了如下 $O(n^2)$ 的代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> n; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> pos[i][j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]; k <span style="color:#f92672">&lt;=</span> pos[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][j]; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> update <span style="color:#f92672">=</span> f[i][k] <span style="color:#f92672">+</span> f[k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][j] <span style="color:#f92672">+</span> w(i, j);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (f[i][j] <span style="color:#f92672">&gt;</span> update) {
</span></span><span style="display:flex;"><span>                f[i][j] <span style="color:#f92672">=</span> update;
</span></span><span style="display:flex;"><span>                pos[i][j] <span style="color:#f92672">=</span> k;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><ul>
<li>注意 $\max$ 函数慎用这个</li>
</ul>
<h1 id="3-字符串">3, 字符串</h1>
<h2 id="3-1-快读">3-1 快读</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">//超快的快读
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define getchar() (tt == ss &amp;&amp; (tt = (ss = In) + fread(In, 1, 1 &lt;&lt; 20, stdin), ss == tt) ? EOF : *ss++)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> In[<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">20</span>], <span style="color:#f92672">*</span>ss <span style="color:#f92672">=</span> In, <span style="color:#f92672">*</span>tt <span style="color:#f92672">=</span> In;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">read</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>res) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> fu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> ch <span style="color:#f92672">=</span> getchar();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (ch <span style="color:#f92672">&lt;</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">||</span> ch <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;9&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;-&#39;</span>)	
</span></span><span style="display:flex;"><span>            fu <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        ch <span style="color:#f92672">=</span> getchar();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (ch <span style="color:#f92672">&gt;=</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">&amp;&amp;</span> ch <span style="color:#f92672">&lt;=</span> <span style="color:#e6db74">&#39;9&#39;</span>)
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> (res <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span> (res <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> ch <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>, ch <span style="color:#f92672">=</span> getchar();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (fu)
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>res;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">inline</span> std<span style="color:#f92672">::</span>istream <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&gt;</span>(std<span style="color:#f92672">::</span>istream <span style="color:#f92672">&amp;</span>in, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    read(a);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> in;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//用法 cin&gt;n;
</span></span></span></code></pre></div><h2 id="3-2-快写">3-2 快写</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">write</span>(__int128 x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        putchar(<span style="color:#e6db74">&#39;-&#39;</span>), x <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">9</span>)
</span></span><span style="display:flex;"><span>        write(x <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>); <span style="color:#75715e">// 递归输出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    putchar(x <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="3-3-kmp">3-3 Kmp</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">kmp_0</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>s, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>link, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// index from 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>fill(link, link <span style="color:#f92672">+</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (j and s[i] <span style="color:#f92672">!=</span> s[j])
</span></span><span style="display:flex;"><span>            j <span style="color:#f92672">=</span> link[j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">+=</span> (s[i] <span style="color:#f92672">==</span> s[j]);
</span></span><span style="display:flex;"><span>        link[i] <span style="color:#f92672">=</span> j;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">match_0</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>t, <span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>S, <span style="color:#66d9ef">int</span> m, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>link) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// index from 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> m; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (j and S[i] <span style="color:#f92672">!=</span> t[j])
</span></span><span style="display:flex;"><span>            j <span style="color:#f92672">=</span> link[j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">+=</span> (S[i] <span style="color:#f92672">==</span> t[j]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (j <span style="color:#f92672">==</span> n) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// is matched
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            j <span style="color:#f92672">=</span> link[j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">kmp_1</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>s, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>link, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// index from 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>fill(link, link <span style="color:#f92672">+</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (j and s[i] <span style="color:#f92672">!=</span> s[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>            j <span style="color:#f92672">=</span> link[j];
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">+=</span> (s[i] <span style="color:#f92672">==</span> s[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>        link[i] <span style="color:#f92672">=</span> j;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">match_1</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>t, <span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>S, <span style="color:#66d9ef">int</span> m, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>link) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// index from 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> m; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (j and S[i] <span style="color:#f92672">!=</span> t[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>            j <span style="color:#f92672">=</span> link[j];
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">+=</span> (S[i] <span style="color:#f92672">==</span> t[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (j <span style="color:#f92672">==</span> n) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// is matched
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            j <span style="color:#f92672">=</span> link[j];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="3-4-z函数">3-4 Z函数</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> z[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Zalgo</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>t, <span style="color:#66d9ef">int</span> tlen, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>s, <span style="color:#66d9ef">int</span> slen, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>p) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// index from 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>fill(z, z <span style="color:#f92672">+</span> tlen <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>); <span style="color:#75715e">// clear
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> tlen; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&lt;</span> r)
</span></span><span style="display:flex;"><span>            z[i] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(z[i <span style="color:#f92672">-</span> l], r <span style="color:#f92672">-</span> i);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (i <span style="color:#f92672">+</span> z[i] <span style="color:#f92672">&lt;</span> tlen and t[i <span style="color:#f92672">+</span> z[i]] <span style="color:#f92672">==</span> t[z[i]])
</span></span><span style="display:flex;"><span>            z[i]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">+</span> z[i] <span style="color:#f92672">&gt;</span> r)
</span></span><span style="display:flex;"><span>            l <span style="color:#f92672">=</span> i, r <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> z[i];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// z[i] 表示t[i,tlen-1]和t的最长公共前缀lcp的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> slen; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&lt;</span> r)
</span></span><span style="display:flex;"><span>            p[i] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(z[i <span style="color:#f92672">-</span> l], r <span style="color:#f92672">-</span> i);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (i <span style="color:#f92672">+</span> p[i] <span style="color:#f92672">&lt;</span> slen and p[i] <span style="color:#f92672">&lt;</span> tlen and s[i <span style="color:#f92672">+</span> p[i]] <span style="color:#f92672">==</span> t[p[i]])
</span></span><span style="display:flex;"><span>            p[i]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">+</span> p[i] <span style="color:#f92672">&gt;</span> r)
</span></span><span style="display:flex;"><span>            l <span style="color:#f92672">=</span> i, r <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> p[i];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// p[i] 表示s[i,slen-1]和t的最长公共前缀lcp的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>$O(n)$</p>
<h2 id="3-5-马拉车">3-5 马拉车</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">manacher</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>s, <span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>r, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>f) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// input with index-1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    s[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[&#39;</span>, s[n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;]&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>, j <span style="color:#f92672">=</span> n; i; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        s[i] <span style="color:#f92672">=</span> (i <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">:</span> s[j<span style="color:#f92672">--</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, far <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>fill(f, f <span style="color:#f92672">+</span> n <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>); <span style="color:#75715e">// initial f
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> (n <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>); i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        r[i] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(r[<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> mid <span style="color:#f92672">-</span> i], far <span style="color:#f92672">-</span> i);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 要是题目说s[i]和s[i]不匹配了这里设 r[i] = 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">while</span> (s[i <span style="color:#f92672">+</span> r[i]] <span style="color:#f92672">==</span> s[i <span style="color:#f92672">-</span> r[i]])
</span></span><span style="display:flex;"><span>            r[i]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (far <span style="color:#f92672">&lt;</span> i <span style="color:#f92672">+</span> r[i])
</span></span><span style="display:flex;"><span>            mid <span style="color:#f92672">=</span> i, far <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> r[i];
</span></span><span style="display:flex;"><span>        f[i <span style="color:#f92672">+</span> r[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(f[i <span style="color:#f92672">+</span> r[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], r[i]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>; i; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>        f[i] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(f[i], f[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// f[i &lt;&lt; 1] 就是以第 i 个字符结尾的最长回文子串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 变换使得 s[i &lt;&lt; 1] 就是原本的 s[i]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// r[i] - 1 是以 i 为中心的回文子串的真实长度
</span></span></span></code></pre></div><h2 id="3-6-ac自动机">3-6 AC自动机</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> s[N], t[<span style="color:#ae81ff">128</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> n, m, tot, slen, tlen;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> ed[N <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>], ht[N <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>], link[N <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>], son[N <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">26</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> f[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> mk[N <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> now <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> tlen; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>son[now][t[i] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>]) {
</span></span><span style="display:flex;"><span>            son[now][t[i] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        now <span style="color:#f92672">=</span> son[now][t[i] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ed[now] <span style="color:#f92672">=</span> tlen;
</span></span><span style="display:flex;"><span>    mk[now] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> tlen;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">build</span>() {
</span></span><span style="display:flex;"><span>    queue<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> q;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (son[<span style="color:#ae81ff">0</span>][i]) {
</span></span><span style="display:flex;"><span>            q.push(son[<span style="color:#ae81ff">0</span>][i]);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>q.empty()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> q.front();
</span></span><span style="display:flex;"><span>        q.pop();
</span></span><span style="display:flex;"><span>        mk[i] <span style="color:#f92672">=</span> mk[i] <span style="color:#f92672">|</span> mk[link[i]];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>j : son[i]) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (j) {
</span></span><span style="display:flex;"><span>                link[j] <span style="color:#f92672">=</span> son[link[i]][k];
</span></span><span style="display:flex;"><span>                q.push(j);
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                j <span style="color:#f92672">=</span> son[link[i]][k];
</span></span><span style="display:flex;"><span>            k<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">signed</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    IOS;
</span></span><span style="display:flex;"><span>    cin <span style="color:#f92672">&gt;&gt;</span> n <span style="color:#f92672">&gt;&gt;</span> m;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (n<span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>        cin <span style="color:#f92672">&gt;&gt;</span> (t <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        tlen <span style="color:#f92672">=</span> strlen(t <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        insert();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    build();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (m<span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>        cin <span style="color:#f92672">&gt;&gt;</span> (s <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        slen <span style="color:#f92672">=</span> strlen(s <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        f[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> slen; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            f[i] <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> now <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> tmp <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> slen; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            now <span style="color:#f92672">=</span> son[now][s[i] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//正常查询应该是 for(int j=now;j;j=link[j])
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (mk[now] <span style="color:#f92672">&amp;</span> (tmp <span style="color:#f92672">&lt;&lt;=</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>                f[i] <span style="color:#f92672">=</span> true, tmp <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>f[slen])
</span></span><span style="display:flex;"><span>            slen<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> slen <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="3-7-后缀数组">3-7 后缀数组</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> N <span style="color:#f92672">=</span> <span style="color:#ae81ff">2e5</span><span style="color:#f92672">+</span><span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// N是字符串的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">SA</span> {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>string s;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// key1[i] = rk[id[i]]（作为基数排序的第一关键字数组）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> n, sa[N], rk[N], ork[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>], id[N], key1[N], cnt[N], ht[N];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> st[N][<span style="color:#ae81ff">20</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// sa[i]是排名为i的后缀的下标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// rk[i]是下标为i的后缀的排名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">cmp</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y, <span style="color:#66d9ef">int</span> w) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ork[x] <span style="color:#f92672">==</span> ork[y] <span style="color:#f92672">&amp;&amp;</span> ork[x <span style="color:#f92672">+</span> w] <span style="color:#f92672">==</span> ork[y <span style="color:#f92672">+</span> w];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">build</span>() {
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> s.size();
</span></span><span style="display:flex;"><span>        s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">+</span> s;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// s串下标从1开始
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">127</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            cnt[rk[i] <span style="color:#f92672">=</span> s[i]]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> m; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            cnt[i] <span style="color:#f92672">+=</span> cnt[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n; i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>            sa[cnt[rk[i]]<span style="color:#f92672">--</span>] <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, u;; w <span style="color:#f92672">&lt;&lt;=</span> <span style="color:#ae81ff">1</span>, m <span style="color:#f92672">=</span> u) { <span style="color:#75715e">// m=u 就是优化计数排序值域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            u <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n; i <span style="color:#f92672">&gt;</span> n <span style="color:#f92672">-</span> w; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>                id[<span style="color:#f92672">++</span>u] <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (sa[i] <span style="color:#f92672">&gt;</span> w)
</span></span><span style="display:flex;"><span>                    id[<span style="color:#f92672">++</span>u] <span style="color:#f92672">=</span> sa[i] <span style="color:#f92672">-</span> w;
</span></span><span style="display:flex;"><span>            memset(cnt, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(cnt));
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//或者也可以 for(int i=0;i&lt;=n+m;i++)cnt[i]=0;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>                cnt[key1[i] <span style="color:#f92672">=</span> rk[id[i]]]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 注意这里px[i] != i，因为rk没有更新，是上一轮的排名数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> m; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                cnt[i] <span style="color:#f92672">+=</span> cnt[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n; i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">--</span>)
</span></span><span style="display:flex;"><span>                sa[cnt[key1[i]]<span style="color:#f92672">--</span>] <span style="color:#f92672">=</span> id[i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                ork[i] <span style="color:#f92672">=</span> rk[i];
</span></span><span style="display:flex;"><span>            u <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                rk[sa[i]] <span style="color:#f92672">=</span> cmp(sa[i], sa[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], w) <span style="color:#f92672">?</span> u : <span style="color:#f92672">++</span>u;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (u <span style="color:#f92672">==</span> n)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//这里往上就是求sa数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> n; <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (rk[i] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (k)
</span></span><span style="display:flex;"><span>                k<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (s[i <span style="color:#f92672">+</span> k] <span style="color:#f92672">==</span> s[sa[rk[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> k])
</span></span><span style="display:flex;"><span>                k<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            ht[rk[i]] <span style="color:#f92672">=</span> k;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//这里是求ht数组
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// ht[i]=lcp(sa[i],sa[i-1])
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// lcp(i,j)是后缀i和后缀j的最长公共前缀
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            st[i][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> ht[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">20</span>; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> (j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">&lt;=</span> n)
</span></span><span style="display:flex;"><span>                    st[i][j] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(st[i][j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], st[i <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> (j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))][j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getmin</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> j) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>__lg(j <span style="color:#f92672">-</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>min(st[i][k], st[j <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> k) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][k]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} pre, pot;
</span></span></code></pre></div><p>复杂度: $O(nlogn)$</p>
<h2 id="3-8-后缀自动机">3-8 后缀自动机</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> s[N]; <span style="color:#75715e">//cin&gt;&gt;(s+1) 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> ZF<span style="color:#f92672">=</span><span style="color:#ae81ff">26</span>;<span style="color:#75715e">//字符集大小，太大就开map，或考虑后缀数组 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> son[N<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">1</span>][ZF],len[N<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">1</span>],link[N<span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">=</span>{<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> tot, last; <span style="color:#75715e">//tot是最大节点(inclusive)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//int cnt[N&lt;&lt;1]; 计算i节点子串出现次数 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">char</span> c) { 
</span></span><span style="display:flex;"><span>	c<span style="color:#f92672">-=</span><span style="color:#e6db74">&#39;a&#39;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> cur <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot; 
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 如果要统计子串出现次数 cnt[cur]++;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	len[cur] <span style="color:#f92672">=</span> len[last] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> v <span style="color:#f92672">=</span> last;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>  and <span style="color:#f92672">!</span>son[v][c]) {  
</span></span><span style="display:flex;"><span>		son[v][c] <span style="color:#f92672">=</span> cur;
</span></span><span style="display:flex;"><span>		v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (v <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) link[cur] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> q <span style="color:#f92672">=</span> son[v][c];
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> len[q]) link[cur] <span style="color:#f92672">=</span> q;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">int</span> clone <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>			len[clone] <span style="color:#f92672">=</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> ZF; i<span style="color:#f92672">++</span>) 
</span></span><span style="display:flex;"><span>				son[clone][i]<span style="color:#f92672">=</span>son[q][i];
</span></span><span style="display:flex;"><span>			link[clone] <span style="color:#f92672">=</span> link[q];
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and son[v][c] <span style="color:#f92672">==</span> q) {
</span></span><span style="display:flex;"><span>				son[v][c] <span style="color:#f92672">=</span> clone;
</span></span><span style="display:flex;"><span>				v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			link[q] <span style="color:#f92672">=</span> link[cur] <span style="color:#f92672">=</span> clone;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	last <span style="color:#f92672">=</span> cur;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>SAM</strong> 压内存 $O(n\log n)$ 写法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> s[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> link[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> {<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>}, len[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>map<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span>, <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> son;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> cnt[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>], pos[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> last, tot;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> id) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> c <span style="color:#f92672">=</span> s[id] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> cur <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// cnt[cur] = 1,  pos[id] = cur;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    len[cur] <span style="color:#f92672">=</span> len[last] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> v <span style="color:#f92672">=</span> last;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and <span style="color:#f92672">!</span>son[{v, c}])
</span></span><span style="display:flex;"><span>        son[{v, c}] <span style="color:#f92672">=</span> cur, v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        link[cur] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> q <span style="color:#f92672">=</span> son[{v, c}];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (len[q] <span style="color:#f92672">==</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            link[cur] <span style="color:#f92672">=</span> q;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> cl <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>            len[cl] <span style="color:#f92672">=</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            link[cl] <span style="color:#f92672">=</span> link[q];
</span></span><span style="display:flex;"><span>            std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> p <span style="color:#f92672">=</span> {q, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>};
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> son.lower_bound(p);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (it <span style="color:#f92672">!=</span> son.end() and it<span style="color:#f92672">-&gt;</span>first.first <span style="color:#f92672">==</span> q) {
</span></span><span style="display:flex;"><span>                son[{cl, it<span style="color:#f92672">-&gt;</span>first.second}] <span style="color:#f92672">=</span> it<span style="color:#f92672">-&gt;</span>second;
</span></span><span style="display:flex;"><span>                it <span style="color:#f92672">=</span> son.upper_bound(it<span style="color:#f92672">-&gt;</span>first);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and son.count({v, c}) and son[{v, c}] <span style="color:#f92672">==</span> q)
</span></span><span style="display:flex;"><span>                son[{v, c}] <span style="color:#f92672">=</span> cl, v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>            link[cur] <span style="color:#f92672">=</span> link[q] <span style="color:#f92672">=</span> cl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    last <span style="color:#f92672">=</span> cur;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- raw HTML omitted -->
<h2 id="3-9-广义后缀自动机在线">3-9 广义后缀自动机（在线）</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> s[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> len[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>], link[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> {<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>}, son[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">26</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> tot, last;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">exadd</span>(<span style="color:#66d9ef">char</span> c) {
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">-=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (son[last][c]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v <span style="color:#f92672">=</span> last, q <span style="color:#f92672">=</span> son[v][c];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (len[q] <span style="color:#f92672">!=</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> cl <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>            len[cl] <span style="color:#f92672">=</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            link[cl] <span style="color:#f92672">=</span> link[q];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                son[cl][i] <span style="color:#f92672">=</span> son[q][i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and son[v][c] <span style="color:#f92672">==</span> q)
</span></span><span style="display:flex;"><span>                son[v][c] <span style="color:#f92672">=</span> cl, v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>            link[q] <span style="color:#f92672">=</span> cl;
</span></span><span style="display:flex;"><span>            q <span style="color:#f92672">=</span> cl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> cur <span style="color:#f92672">=</span> last <span style="color:#f92672">=</span> q;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 可以在这里 对cur点加信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> cur <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>    len[cur] <span style="color:#f92672">=</span> len[last] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//在这里对 cur点加信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> v <span style="color:#f92672">=</span> last;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and son[v][c] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        son[v][c] <span style="color:#f92672">=</span> cur, v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        link[cur] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> q <span style="color:#f92672">=</span> son[v][c];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (len[q] <span style="color:#f92672">==</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            link[cur] <span style="color:#f92672">=</span> q;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> cl <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>            len[cl] <span style="color:#f92672">=</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            link[cl] <span style="color:#f92672">=</span> link[q];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                son[cl][i] <span style="color:#f92672">=</span> son[q][i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and son[v][c] <span style="color:#f92672">==</span> q)
</span></span><span style="display:flex;"><span>                son[v][c] <span style="color:#f92672">=</span> cl, v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>            link[q] <span style="color:#f92672">=</span> link[cur] <span style="color:#f92672">=</span> cl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    last <span style="color:#f92672">=</span> cur;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="3-10-广义后缀自动机离线">3-10 广义后缀自动机(离线)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">char</span> s[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> len[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>], link[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> {<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>}, son[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">26</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> tot;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">exadd</span>(<span style="color:#66d9ef">int</span> last, <span style="color:#66d9ef">int</span> c) { <span style="color:#75715e">// last and nowchar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> cur <span style="color:#f92672">=</span> son[last][c];
</span></span><span style="display:flex;"><span>    len[cur] <span style="color:#f92672">=</span> len[last] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> v <span style="color:#f92672">=</span> link[last]; <span style="color:#75715e">//如果没有这一步 下一个 while 会直接break
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and son[v][c] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        son[v][c] <span style="color:#f92672">=</span> cur, v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        link[cur] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> q <span style="color:#f92672">=</span> son[v][c];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (len[q] <span style="color:#f92672">==</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            link[cur] <span style="color:#f92672">=</span> q;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> cl <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot; <span style="color:#75715e">// clone to q
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            len[cl] <span style="color:#f92672">=</span> len[v] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            link[cl] <span style="color:#f92672">=</span> link[q];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                son[cl][i] <span style="color:#f92672">=</span> (len[son[q][i]] <span style="color:#f92672">?</span> son[q][i] <span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>); <span style="color:#75715e">//这里和sam不一样
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">while</span> (v <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> and son[v][c] <span style="color:#f92672">==</span> q)
</span></span><span style="display:flex;"><span>                son[v][c] <span style="color:#f92672">=</span> cl, v <span style="color:#f92672">=</span> link[v];
</span></span><span style="display:flex;"><span>            link[cur] <span style="color:#f92672">=</span> link[q] <span style="color:#f92672">=</span> cl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cur;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">trie</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> slen <span style="color:#f92672">=</span> strlen(s <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> slen; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (son[p][s[j] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            son[p][s[j] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> son[p][s[j] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 如果有需要可以在这个位置进行线段树动态开点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// root[p] = tradd(root[p], 1, n, id);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">buildExSam</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>queue<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;&gt;</span> q;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (son[<span style="color:#ae81ff">0</span>][i])
</span></span><span style="display:flex;"><span>            q.push({<span style="color:#ae81ff">0</span>, i}); <span style="color:#75715e">// last and nowchar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>q.empty()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> p <span style="color:#f92672">=</span> q.front();
</span></span><span style="display:flex;"><span>        q.pop();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> last <span style="color:#f92672">=</span> exadd(p.first, p.second);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (son[last][i])
</span></span><span style="display:flex;"><span>                q.push({last, i});
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 一个性质好像是trie()之后build()之前，1-tot都是endpos
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// std::cin &gt;&gt; n; // 输入字符串个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// for (int i = 1; i &lt;= n; i++)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//     std::cin &gt;&gt; (s + 1), trie();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// buildExSam();
</span></span></span></code></pre></div><h2 id="3-11-最小表示法">3-11 最小表示法</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> minShift(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> a.size();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (k <span style="color:#f92672">&lt;</span> n and i <span style="color:#f92672">&lt;</span> n and j <span style="color:#f92672">&lt;</span> n) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (a[(i <span style="color:#f92672">+</span> k) <span style="color:#f92672">%</span> n] <span style="color:#f92672">==</span> a[(j <span style="color:#f92672">+</span> k) <span style="color:#f92672">%</span> n])
</span></span><span style="display:flex;"><span>            k<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            (a[(i <span style="color:#f92672">+</span> k) <span style="color:#f92672">%</span> n] <span style="color:#f92672">&gt;</span> a[(j <span style="color:#f92672">+</span> k) <span style="color:#f92672">%</span> n] <span style="color:#f92672">?</span> i : j) <span style="color:#f92672">+=</span> k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            i <span style="color:#f92672">+=</span> (i <span style="color:#f92672">==</span> j);
</span></span><span style="display:flex;"><span>            k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    k <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(i, j);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> ans(n);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        ans[i] <span style="color:#f92672">=</span> a[(i <span style="color:#f92672">+</span> k) <span style="color:#f92672">%</span> n];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 直接返回字典序最小循环同构串
</span></span></span></code></pre></div><h1 id="4-数据结构">4, 数据结构</h1>
<h2 id="4-1-动态bitset">4-1 动态bitset</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span> LEN<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> solve(<span style="color:#66d9ef">int</span> m) { <span style="color:#75715e">// 要开 m 大小的bitset
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (LEN <span style="color:#f92672">&lt;</span> m)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> solve<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>min(N, (LEN <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>))<span style="color:#f92672">&gt;</span>(m);
</span></span><span style="display:flex;"><span>  	std<span style="color:#f92672">::</span>bitset<span style="color:#f92672">&lt;</span>LEN<span style="color:#f92672">&gt;</span> f;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 用法  solve&lt;1&gt;(m)
</span></span></span></code></pre></div><h2 id="4-2-带权并查集">4-2 带权并查集</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">find</span>(<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (f[x] <span style="color:#f92672">==</span> x)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> F <span style="color:#f92672">=</span> f[x];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> res <span style="color:#f92672">=</span> find(f[x]);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// g[x] &lt;- g[F] 看情况把原父亲的信息压缩到x上
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 比如 g[x] ^= g[F];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> f[x] <span style="color:#f92672">=</span> res;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Union</span>(<span style="color:#66d9ef">int</span> u, <span style="color:#66d9ef">int</span> v, <span style="color:#66d9ef">int</span> w) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> fu <span style="color:#f92672">=</span> find(u), fv <span style="color:#f92672">=</span> find(v);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (fu <span style="color:#f92672">==</span> fv)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// g[fv] &lt;- (g[u], g[v], w)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 四边形将 v-&gt;u 转移到 fv-&gt;fu
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 比如 g[fv] = w ^ g[u] ^ g[v];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    f[fv] <span style="color:#f92672">=</span> fu;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-3-可删堆">4-3 可删堆</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">T</span>, <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">cmp</span> <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>less<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">heap</span> {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>priority_queue<span style="color:#f92672">&lt;</span>T, std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>, cmp<span style="color:#f92672">&gt;</span> A, B; <span style="color:#75715e">// heap=A-B
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">push</span>(T x) { A.push(x); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">erase</span>(T x) { B.push(x); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    T <span style="color:#a6e22e">top</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>B.empty() <span style="color:#f92672">&amp;&amp;</span> A.top() <span style="color:#f92672">==</span> B.top())
</span></span><span style="display:flex;"><span>            A.pop(), B.pop();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> A.top();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pop</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>B.empty() <span style="color:#f92672">&amp;&amp;</span> A.top() <span style="color:#f92672">==</span> B.top())
</span></span><span style="display:flex;"><span>            A.pop(), B.pop();
</span></span><span style="display:flex;"><span>        A.pop();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">size</span>() { <span style="color:#66d9ef">return</span> A.size() <span style="color:#f92672">-</span> B.size(); }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="4-4-树哈希">4-4 树哈希</h2>
<p>有根树哈希 : $hash(x)$ 表示以 $x$ 为根的子树的哈希值, $f( )$ 是随机函数
$$
hash(x) = 1+\sum_{y\ is \ son \ of \ x} f(hash(y))
$$
无根树哈希则取树重心即可, 或者换根dp得到所有点为根的$hash$值, $f$ 函数如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> u64 <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span>;
</span></span><span style="display:flex;"><span>u64 <span style="color:#a6e22e">f</span>(u64 x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> h <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](u64 y) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (u64)y <span style="color:#f92672">*</span> y <span style="color:#f92672">*</span> y <span style="color:#f92672">*</span> <span style="color:#ae81ff">1237123</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">19260817</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> h(x <span style="color:#f92672">&amp;</span> ((<span style="color:#ae81ff">1ll</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">31</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">+</span> h(x <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">31</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-5-区间嵌套树">4-5 区间嵌套树</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define pii std::pair&lt;int, int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define l first
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define r second
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> n, m;
</span></span><span style="display:flex;"><span>pii seg[N]; <span style="color:#75715e">// 区间数组,建树以下标索引区间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> e[N]; <span style="color:#75715e">// 树
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">signed</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> n <span style="color:#f92672">&gt;&gt;</span> m;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> l, r, i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> m; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> l <span style="color:#f92672">&gt;&gt;</span> r; <span style="color:#75715e">// 输入
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        seg[i] <span style="color:#f92672">=</span> (pii){l, r};
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    seg[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1</span>, n}; <span style="color:#75715e">// 全局区间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>sort(seg, seg <span style="color:#f92672">+</span> m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>); <span style="color:#75715e">// 大概率题目是需要去重的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    m <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>unique(seg, seg <span style="color:#f92672">+</span> m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">-</span> (seg <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>sort(seg, seg <span style="color:#f92672">+</span> m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> a.l <span style="color:#f92672">==</span> b.l <span style="color:#f92672">?</span> a.r <span style="color:#f92672">&gt;</span> b.r : a.l <span style="color:#f92672">&lt;</span> b.l;
</span></span><span style="display:flex;"><span>    }); <span style="color:#75715e">// 排序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> q(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>); <span style="color:#75715e">// 栈, 里面初始元素是全局区间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> m; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (seg[q.back()].r <span style="color:#f92672">&lt;</span> seg[i].l) <span style="color:#75715e">// 找到第一个包含seg[i]的区间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            q.pop_back();
</span></span><span style="display:flex;"><span>        e[q.back()].push_back(i);
</span></span><span style="display:flex;"><span>        q.push_back(i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这样一个区间嵌套树就建出来了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="4-6-圆嵌套树">4-6 圆嵌套树</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i64 <span style="color:#a6e22e">pf</span>(<span style="color:#66d9ef">int</span> a) { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> a; }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> N <span style="color:#f92672">=</span> <span style="color:#ae81ff">2e5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> ld eps <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e-8</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Circle</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x, y, r;
</span></span><span style="display:flex;"><span>} c[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">event</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> op;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;</span>(<span style="color:#66d9ef">const</span> event <span style="color:#f92672">&amp;</span>a) <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> u <span style="color:#f92672">=</span> c[id].x <span style="color:#f92672">+</span> (op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;L&#39;</span> <span style="color:#f92672">?</span> <span style="color:#f92672">-</span>c[id].r : c[id].r);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v <span style="color:#f92672">=</span> c[a.id].x <span style="color:#f92672">+</span> (a.op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;L&#39;</span> <span style="color:#f92672">?</span> <span style="color:#f92672">-</span>c[a.id].r : c[a.id].r);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> u <span style="color:#f92672">&lt;</span> v;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} e[N <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Semi</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> X;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> half;
</span></span><span style="display:flex;"><span>    Semi(<span style="color:#66d9ef">int</span> jd, <span style="color:#66d9ef">char</span> h) <span style="color:#f92672">:</span> id(jd), half(h) {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;</span>(<span style="color:#66d9ef">const</span> Semi <span style="color:#f92672">&amp;</span>a) <span style="color:#66d9ef">const</span> { <span style="color:#75715e">// 一定要const
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ld u <span style="color:#f92672">=</span> c[id].y <span style="color:#f92672">+</span> (half <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;u&#39;</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> sqrtl(pf(c[id].r) <span style="color:#f92672">-</span> pf(X <span style="color:#f92672">-</span> c[id].x) <span style="color:#f92672">+</span> eps); <span style="color:#75715e">// + eps 很重要
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ld v <span style="color:#f92672">=</span> c[a.id].y <span style="color:#f92672">+</span> (a.half <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;u&#39;</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> sqrtl(pf(c[a.id].r) <span style="color:#f92672">-</span> pf(X <span style="color:#f92672">-</span> c[a.id].x) <span style="color:#f92672">+</span> eps); <span style="color:#75715e">// + eps 很重要
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> u <span style="color:#f92672">&lt;</span> v;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> Semi<span style="color:#f92672">::</span>X <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> g[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> link[N];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">signed</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> n;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> c[i].x <span style="color:#f92672">&gt;&gt;</span> c[i].y <span style="color:#f92672">&gt;&gt;</span> c[i].r;
</span></span><span style="display:flex;"><span>        e[i <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].id <span style="color:#f92672">=</span> e[i <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>].id <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>        e[i <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].op <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;L&#39;</span>, e[i <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>].op <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;R&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 拆成上半圆和下半圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>sort(e <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, e <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>set<span style="color:#f92672">&lt;</span>Semi<span style="color:#f92672">&gt;</span> set;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        Semi<span style="color:#f92672">::</span>X <span style="color:#f92672">=</span> c[e[i].id].x <span style="color:#f92672">+</span> (e[i].op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;L&#39;</span> <span style="color:#f92672">?</span> <span style="color:#f92672">-</span>c[e[i].id].r : c[e[i].id].r);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 扫描线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (e[i].op <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;R&#39;</span>) {
</span></span><span style="display:flex;"><span>            set.erase((Semi){e[i].id, <span style="color:#e6db74">&#39;u&#39;</span>});
</span></span><span style="display:flex;"><span>            set.erase((Semi){e[i].id, <span style="color:#e6db74">&#39;d&#39;</span>});
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            set.insert((Semi){e[i].id, <span style="color:#e6db74">&#39;u&#39;</span>});
</span></span><span style="display:flex;"><span>            set.insert((Semi){e[i].id, <span style="color:#e6db74">&#39;d&#39;</span>});
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> set.upper_bound((Semi){e[i].id, <span style="color:#e6db74">&#39;u&#39;</span>});
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (it <span style="color:#f92672">==</span> set.end())
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            link[e[i].id] <span style="color:#f92672">=</span> (it<span style="color:#f92672">-&gt;</span>half <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;u&#39;</span> <span style="color:#f92672">?</span> it<span style="color:#f92672">-&gt;</span>id : link[it<span style="color:#f92672">-&gt;</span>id]);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        g[link[i]].push_back(i);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这样 g 图就是一个圆的包含树了, 0 是 虚空大圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="4-7-点分治">4-7 点分治</h2>
<h4 id="树重心">树重心</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//------------------------get root---------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> mk[N], size[N], maxs[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> root;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getRoot</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> fa, <span style="color:#66d9ef">int</span> tot) {
</span></span><span style="display:flex;"><span>    size[x] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    maxs[x] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// 表示 x 为根的子树里的最大子树的size
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [y, w] <span style="color:#f92672">:</span> e[x]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">==</span> fa or mk[y])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>        getRoot(y, x, tot);
</span></span><span style="display:flex;"><span>        size[x] <span style="color:#f92672">+=</span> size[y];
</span></span><span style="display:flex;"><span>        maxs[x] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(maxs[x], size[y]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    maxs[x] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(maxs[x], tot <span style="color:#f92672">-</span> size[x]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (root <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> or maxs[x] <span style="color:#f92672">&lt;</span> maxs[root])
</span></span><span style="display:flex;"><span>        root <span style="color:#f92672">=</span> x;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//-----------计算过x点的路径的情况------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getDis</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> fa, <span style="color:#66d9ef">int</span> len) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// arr2 &lt;- len
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [y, w] <span style="color:#f92672">:</span> e[x]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">==</span> fa or mk[y])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>        getDis(y, x, len <span style="color:#f92672">+</span> w);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">calc</span>(<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// clear arr1 + 加入根信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [y, w] <span style="color:#f92672">:</span> e[x]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (mk[y])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// clear arr2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        getDis(y, x, w); <span style="color:#75715e">// update arr2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 计算答案 ans &lt;- arr1 + arr2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 更新容器 arr1 &lt;- arr2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//------------x就是当前重心，然后去分治------------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">divide</span>(<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    mk[x] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    calc(x);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [y, w] <span style="color:#f92672">:</span> e[x]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (mk[y])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>        root <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        getRoot(y, x, size[y]);
</span></span><span style="display:flex;"><span>        getRoot(root, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, size[y]);
</span></span><span style="display:flex;"><span>        divide(root);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">signed</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>ios_base<span style="color:#f92672">::</span>sync_with_stdio(<span style="color:#ae81ff">0</span>), std<span style="color:#f92672">::</span>cin.tie(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> n;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> u, v, w, i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cin <span style="color:#f92672">&gt;&gt;</span> u <span style="color:#f92672">&gt;&gt;</span> v <span style="color:#f92672">&gt;&gt;</span> w;
</span></span><span style="display:flex;"><span>        e[u].push_back({v, w});
</span></span><span style="display:flex;"><span>        e[v].push_back({u, w});
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// input query
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    root <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    getRoot(<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, n);
</span></span><span style="display:flex;"><span>    getRoot(root, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, n);
</span></span><span style="display:flex;"><span>    divide(root);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// output answer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="4-8-树状数组">4-8 树状数组</h2>
<h3 id="4-8-1-区间修改区间查询">4-8-1 区间修改+区间查询</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">T</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">BIT</span> {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> t[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>    BIT(<span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>        t[<span style="color:#ae81ff">0</span>].assign(n, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        t[<span style="color:#ae81ff">1</span>].assign(n, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r, T x) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (; r <span style="color:#f92672">&lt;</span> t[<span style="color:#ae81ff">0</span>].size(); r <span style="color:#f92672">+=</span> r <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>r)
</span></span><span style="display:flex;"><span>                t[<span style="color:#f92672">-</span>l][r] <span style="color:#f92672">+=</span> x;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            add(<span style="color:#ae81ff">0</span>, l, x);
</span></span><span style="display:flex;"><span>            add(<span style="color:#ae81ff">0</span>, r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span>x);
</span></span><span style="display:flex;"><span>            add(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, l, l <span style="color:#f92672">*</span> x);
</span></span><span style="display:flex;"><span>            add(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span>(r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> x);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    T <span style="color:#a6e22e">get</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>        T res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (; r; r <span style="color:#f92672">-=</span> r <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>r)
</span></span><span style="display:flex;"><span>                res <span style="color:#f92672">+=</span> t[<span style="color:#f92672">-</span>l][r];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">=</span> (r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> get(<span style="color:#ae81ff">0</span>, r) <span style="color:#f92672">-</span> get(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, r);
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">-=</span> l <span style="color:#f92672">*</span> get(<span style="color:#ae81ff">0</span>, l <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">-</span> get(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, l <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> res;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h3 id="4-8-2-二维子矩阵加子矩阵求和">4-8-2 二维,子矩阵加&amp;子矩阵求和</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>i64 t1[N][N], t2[N][N], t3[N][N], t4[N][N];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y, <span style="color:#66d9ef">int</span> v) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> x; i <span style="color:#f92672">&lt;=</span> n; i <span style="color:#f92672">+=</span> i <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>i)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> y; j <span style="color:#f92672">&lt;=</span> m; j <span style="color:#f92672">+=</span> j <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>j) {
</span></span><span style="display:flex;"><span>            t1[i][j] <span style="color:#f92672">+=</span> v;
</span></span><span style="display:flex;"><span>            t2[i][j] <span style="color:#f92672">+=</span> v <span style="color:#f92672">*</span> x;
</span></span><span style="display:flex;"><span>            t3[i][j] <span style="color:#f92672">+=</span> v <span style="color:#f92672">*</span> y;
</span></span><span style="display:flex;"><span>            t4[i][j] <span style="color:#f92672">+=</span> v <span style="color:#f92672">*</span> x <span style="color:#f92672">*</span> y;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> xa, <span style="color:#66d9ef">int</span> ya, <span style="color:#66d9ef">int</span> xb, <span style="color:#66d9ef">int</span> yb, <span style="color:#66d9ef">int</span> v) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//(xa, ya) 到 (xb, yb) 子矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    update(xa, ya, v);
</span></span><span style="display:flex;"><span>    update(xa, yb <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span>v);
</span></span><span style="display:flex;"><span>    update(xb <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, ya, <span style="color:#f92672">-</span>v);
</span></span><span style="display:flex;"><span>    update(xb <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, yb <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, v);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i64 <span style="color:#a6e22e">sum</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>    i64 res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> x; i; i <span style="color:#f92672">-=</span> i <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>i)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> y; j; j <span style="color:#f92672">-=</span> j <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>j)
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">+=</span> (x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> t1[i][j] <span style="color:#f92672">-</span> (y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> t2[i][j] <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>                   (x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> t3[i][j] <span style="color:#f92672">+</span> t4[i][j];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i64 <span style="color:#a6e22e">get</span>(<span style="color:#66d9ef">int</span> xa, <span style="color:#66d9ef">int</span> ya, <span style="color:#66d9ef">int</span> xb, <span style="color:#66d9ef">int</span> yb) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//(xa, ya) 到 (xb, yb) 子矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> sum(xb, yb) <span style="color:#f92672">-</span> sum(xb, ya <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">-</span> sum(xa <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, yb) <span style="color:#f92672">+</span> sum(xa <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, ya <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- raw HTML omitted -->
<h3 id="4-8-3-求区间最值">4-8-3 求区间最值</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 单点修改，查最小值只能改小，查最大值只能改大
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> b[N], t[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">modify</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    b[i] <span style="color:#f92672">=</span> x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; i <span style="color:#f92672">&lt;</span> N; i <span style="color:#f92672">+=</span> i <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>i)
</span></span><span style="display:flex;"><span>        t[i] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(t[i], x);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 区间查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">30</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (l <span style="color:#f92672">&lt;=</span> r) {
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(res, b[r<span style="color:#f92672">--</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (; l <span style="color:#f92672">&lt;=</span> r <span style="color:#f92672">-</span> (r <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>r); r <span style="color:#f92672">-=</span> r <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>r) 
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(res, t[r]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-9-树链剖分">4-9 树链剖分</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// modify 和 get 是线段树
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>pair<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;&gt;</span> e[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> n, qn, tot;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> dfn[N], big[N], fa[N], size[N], dep[N], tp[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dfs1</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> f) {
</span></span><span style="display:flex;"><span>    fa[i] <span style="color:#f92672">=</span> f;
</span></span><span style="display:flex;"><span>    dep[i] <span style="color:#f92672">=</span> dep[f] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    size[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [j, w] <span style="color:#f92672">:</span> e[i])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (j <span style="color:#f92672">!=</span> f) {
</span></span><span style="display:flex;"><span>            dfs1(j, i);
</span></span><span style="display:flex;"><span>            size[i] <span style="color:#f92672">+=</span> size[j];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (size[j] <span style="color:#f92672">&gt;</span> size[big[i]])
</span></span><span style="display:flex;"><span>                big[i] <span style="color:#f92672">=</span> j;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dfs2</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> top) {
</span></span><span style="display:flex;"><span>    tp[i] <span style="color:#f92672">=</span> top;
</span></span><span style="display:flex;"><span>    dfn[i] <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (big[i])
</span></span><span style="display:flex;"><span>        dfs2(big[i], top);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [j, w] <span style="color:#f92672">:</span> e[i]) {
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (j <span style="color:#f92672">!=</span> fa[i] and j <span style="color:#f92672">!=</span> big[i])
</span></span><span style="display:flex;"><span>            dfs2(j, j);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">lca</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (tp[x] <span style="color:#f92672">!=</span> tp[y])
</span></span><span style="display:flex;"><span>        (dep[tp[x]] <span style="color:#f92672">&gt;</span> dep[tp[y]] <span style="color:#f92672">?</span> x <span style="color:#f92672">=</span> fa[tp[x]] <span style="color:#f92672">:</span> y <span style="color:#f92672">=</span> fa[tp[y]]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (dep[x] <span style="color:#f92672">&lt;</span> dep[y] <span style="color:#f92672">?</span> x : y);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">trget</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>    node ans[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>    ans[<span style="color:#ae81ff">0</span>].s <span style="color:#f92672">=</span> ans[<span style="color:#ae81ff">1</span>].s <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xy <span style="color:#f92672">=</span> lca(x, y);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i : {x, y}) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (; tp[i] <span style="color:#f92672">!=</span> tp[xy]; i <span style="color:#f92672">=</span> fa[tp[i]])
</span></span><span style="display:flex;"><span>            ans[j] <span style="color:#f92672">=</span> get(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, n, dfn[tp[i]], dfn[i]) <span style="color:#f92672">+</span> ans[j];
</span></span><span style="display:flex;"><span>        ans[j] <span style="color:#f92672">=</span> get(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, n, dfn[xy], dfn[i]) <span style="color:#f92672">+</span> ans[j];
</span></span><span style="display:flex;"><span>        j<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ans[<span style="color:#ae81ff">0</span>].reverse();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> res <span style="color:#f92672">=</span> ans[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> ans[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res.s;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">trmodify</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y, <span style="color:#66d9ef">int</span> c) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xy <span style="color:#f92672">=</span> lca(x, y);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i : {x, y}) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (; tp[i] <span style="color:#f92672">!=</span> tp[xy]; i <span style="color:#f92672">=</span> fa[tp[i]])
</span></span><span style="display:flex;"><span>            modify(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, n, dfn[tp[i]], dfn[i], c);
</span></span><span style="display:flex;"><span>        modify(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, n, dfn[xy], dfn[i], c);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-10-主席树求区间第k小">4-10 主席树求区间第k小</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> t[N <span style="color:#f92672">*</span> <span style="color:#ae81ff">80</span>], ls[N <span style="color:#f92672">*</span> <span style="color:#ae81ff">80</span>], rs[N <span style="color:#f92672">*</span> <span style="color:#ae81ff">80</span>], root[N], tot;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 动态开点 -&gt; 左右儿子 + 空间开大 + tot
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// t[i] 表示对应值域区间里有多少个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> j, <span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r, <span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// j 为第i-1棵值域线段树上的对应点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// l, r 是值域区间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">==</span> r) {
</span></span><span style="display:flex;"><span>        t[i] <span style="color:#f92672">=</span> t[j] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> i;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ls[i] <span style="color:#f92672">=</span> ls[j], rs[i] <span style="color:#f92672">=</span> rs[j];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">&lt;=</span> mid)
</span></span><span style="display:flex;"><span>        ls[i] <span style="color:#f92672">=</span> add(ls[j], l, mid, x);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        rs[i] <span style="color:#f92672">=</span> add(rs[j], mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r, x);
</span></span><span style="display:flex;"><span>    t[i] <span style="color:#f92672">=</span> t[ls[i]] <span style="color:#f92672">+</span> t[rs[i]]; <span style="color:#75715e">// up(i)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> i;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get</span>(<span style="color:#66d9ef">int</span> j, <span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r, <span style="color:#66d9ef">int</span> k) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// l, r 是值域区间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">==</span> r)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> l;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> L <span style="color:#f92672">=</span> t[ls[i]] <span style="color:#f92672">-</span> t[ls[j]];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (L <span style="color:#f92672">&gt;=</span> k) <span style="color:#75715e">// 线段树上二分
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> get(ls[j], ls[i], l, mid, k);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> get(rs[j], rs[i], mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r, k <span style="color:#f92672">-</span> L);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-11-树状数组套值域线段树">4-11 树状数组套值域线段树</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> root[N], t[N <span style="color:#f92672">*</span> <span style="color:#ae81ff">180</span>], ls[N <span style="color:#f92672">*</span> <span style="color:#ae81ff">180</span>], rs[N <span style="color:#f92672">*</span> <span style="color:#ae81ff">180</span>], tot;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">modify</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>i, <span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r, <span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 第i个线段树里x的位置+y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>i) i <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>tot;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">==</span> r) {
</span></span><span style="display:flex;"><span>        t[i] <span style="color:#f92672">+=</span> y;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">&lt;=</span> mid) modify(ls[i], l, mid, x, y);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> modify(rs[i], mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r, x, y);
</span></span><span style="display:flex;"><span>    t[i] <span style="color:#f92672">=</span> t[ls[i]] <span style="color:#f92672">+</span> t[rs[i]]; <span style="color:#75715e">//up(i)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; i <span style="color:#f92672">&lt;</span> N; i <span style="color:#f92672">+=</span> i <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>i)
</span></span><span style="display:flex;"><span>        modify(root[i], <span style="color:#ae81ff">1</span>, m, x, y);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> po, ne; <span style="color:#75715e">// 树状数组的两个前缀和相减 po - ne
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// po 和 ne 里存的是线段树同一区间的节点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">get1</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>    po.clear(), ne.clear();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (l<span style="color:#f92672">--</span>; l; l <span style="color:#f92672">-=</span> l <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>l)
</span></span><span style="display:flex;"><span>        ne.push_back(root[l]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; r; r <span style="color:#f92672">-=</span> r <span style="color:#f92672">&amp;</span> <span style="color:#f92672">-</span>r)
</span></span><span style="display:flex;"><span>        po.push_back(root[r]);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get2</span>(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r, <span style="color:#66d9ef">int</span> k) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">==</span> r) <span style="color:#66d9ef">return</span> l;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i : po) sum <span style="color:#f92672">+=</span> t[ls[i]];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i : ne) sum <span style="color:#f92672">-=</span> t[ls[i]];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (k <span style="color:#f92672">&lt;=</span> sum) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>i : po) i <span style="color:#f92672">=</span> ls[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>i : ne) i <span style="color:#f92672">=</span> ls[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> get2(l, mid, k);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>i : po) i <span style="color:#f92672">=</span> rs[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>i : ne) i <span style="color:#f92672">=</span> rs[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> get2(mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r, k <span style="color:#f92672">-</span> sum);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-12-线段树合并">4-12 线段树合并</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">merge</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b, <span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>a) <span style="color:#66d9ef">return</span> b;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>b) <span style="color:#66d9ef">return</span> a;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 如果需要合并之后 还要区间查询或者单点查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// 就要np=++tot
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// return np
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// 而且空间要开很大
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">==</span> r) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something of merge
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> a;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> (l <span style="color:#f92672">+</span> r) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  tr[a].l <span style="color:#f92672">=</span> merge(tr[a].l, tr[b].l, l, mid);
</span></span><span style="display:flex;"><span>  tr[a].r <span style="color:#f92672">=</span> merge(tr[a].r, tr[b].r, mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r);
</span></span><span style="display:flex;"><span>  pushup(a);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> a;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-13-李超线段树">4-13 李超线段树</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> LM <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, RM <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e9</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 横坐标的左右边界, 注意视情况调节
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">line</span> {
</span></span><span style="display:flex;"><span>    ld k, b;            <span style="color:#75715e">// 线段斜率, 截距
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> l <span style="color:#f92672">=</span> LM, r <span style="color:#f92672">=</span> RM; <span style="color:#75715e">// 线段左右边界
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    ld <span style="color:#a6e22e">at</span>(<span style="color:#66d9ef">int</span> x) { <span style="color:#66d9ef">return</span> k <span style="color:#f92672">*</span> x <span style="color:#f92672">+</span> b; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">friend</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">cross</span>(<span style="color:#66d9ef">const</span> line <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> line <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> floor((a.b <span style="color:#f92672">-</span> b.b) <span style="color:#f92672">/</span> (b.k <span style="color:#f92672">-</span> a.k));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">node</span> {
</span></span><span style="display:flex;"><span>    line seg;
</span></span><span style="display:flex;"><span>    node <span style="color:#f92672">*</span>ls, <span style="color:#f92672">*</span>rs;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">LiChaoTree</span> {
</span></span><span style="display:flex;"><span>    LiChaoTree() { rt <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> node(); }  <span style="color:#75715e">// 一定要加括号初始化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert</span>(ld k, ld b, <span style="color:#66d9ef">int</span> lm <span style="color:#f92672">=</span> LM, <span style="color:#66d9ef">int</span> rm <span style="color:#f92672">=</span> RM) {
</span></span><span style="display:flex;"><span>        line Z <span style="color:#f92672">=</span> (line){k, b, lm, rm};
</span></span><span style="display:flex;"><span>        modify(rt, LM, RM, Z);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ld <span style="color:#a6e22e">get</span>(<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> query(rt, LM, RM, x);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> ld eps <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e-9</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">sgn</span>(<span style="color:#66d9ef">const</span> ld <span style="color:#f92672">&amp;</span>a) { <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span>eps <span style="color:#f92672">?</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> a <span style="color:#f92672">&gt;</span> eps); }
</span></span><span style="display:flex;"><span>    node <span style="color:#f92672">*</span>rt;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">modify</span>(node <span style="color:#f92672">*&amp;</span>p, <span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r, line Z) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>p) <span style="color:#75715e">// 一定要传node*&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> node();  <span style="color:#75715e">// 一定要加括号初始化!!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (Z.l <span style="color:#f92672">&lt;=</span> l <span style="color:#f92672">&amp;&amp;</span> r <span style="color:#f92672">&lt;=</span> Z.r) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> L <span style="color:#f92672">=</span> sgn(Z.at(l) <span style="color:#f92672">-</span> p<span style="color:#f92672">-&gt;</span>seg.at(l));
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> R <span style="color:#f92672">=</span> sgn(Z.at(r) <span style="color:#f92672">-</span> p<span style="color:#f92672">-&gt;</span>seg.at(r));
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (L <span style="color:#f92672">+</span> R <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) { <span style="color:#75715e">// 新线段完全在老线段之上
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                p<span style="color:#f92672">-&gt;</span>seg <span style="color:#f92672">=</span> Z;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (L <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> or R <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) { <span style="color:#75715e">// 新线段不完全在老线段之上
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (sgn(Z.at(mid) <span style="color:#f92672">-</span> p<span style="color:#f92672">-&gt;</span>seg.at(mid)) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                    std<span style="color:#f92672">::</span>swap(p<span style="color:#f92672">-&gt;</span>seg, Z);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (sgn(cross(Z, p<span style="color:#f92672">-&gt;</span>seg) <span style="color:#f92672">-</span> mid) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                    modify(p<span style="color:#f92672">-&gt;</span>ls, l, mid, Z);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                    modify(p<span style="color:#f92672">-&gt;</span>rs, mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r, Z);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (Z.l <span style="color:#f92672">&lt;=</span> mid)
</span></span><span style="display:flex;"><span>                modify(p<span style="color:#f92672">-&gt;</span>ls, l, mid, Z);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (mid <span style="color:#f92672">&lt;</span> Z.r)
</span></span><span style="display:flex;"><span>                modify(p<span style="color:#f92672">-&gt;</span>rs, mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r, Z);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ld <span style="color:#a6e22e">query</span>(node <span style="color:#f92672">*&amp;</span>p, <span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r, <span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>p)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        ld ans <span style="color:#f92672">=</span> p<span style="color:#f92672">-&gt;</span>seg.at(x);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (l <span style="color:#f92672">&lt;</span> r)
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(ans, (x <span style="color:#f92672">&lt;=</span> mid <span style="color:#f92672">?</span> query(p<span style="color:#f92672">-&gt;</span>ls, l, mid, x) <span style="color:#f92672">:</span> query(p<span style="color:#f92672">-&gt;</span>rs, mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r, x)));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">用法 : 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">先调节 LM, RM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">LiChaoTree t;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">t.insert(斜率, 截距);  //插入直线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">t.insert(斜率, 截距, 左x, 右x);  //插入线段
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">t.get(x);  //得到x处最大y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><h2 id="4-14-pbds平衡树">4-14 pbds平衡树</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;bits/extc++.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define pb __gnu_pbds 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// 这些都要求g++编译器, clang++不支持
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>pb<span style="color:#f92672">::</span>tree<span style="color:#f92672">&lt;</span>T, pb<span style="color:#f92672">::</span>null_type, std<span style="color:#f92672">::</span>less<span style="color:#f92672">&lt;&gt;</span>, pb<span style="color:#f92672">::</span>rb_tree_tag, pb<span style="color:#f92672">::</span>tree_order_statistics_node_update<span style="color:#f92672">&gt;</span> t; <span style="color:#75715e">// 红黑树
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 当set用,多下面两个函数, 注意其中会自动去重, 所以往往使用 T = std::pair&lt;int, int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>t.order_of_key(x); <span style="color:#75715e">// 查询有多少元素比x小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>t.find_by_order(x); <span style="color:#75715e">// 查询有x个元素比它小的元素的迭代器
</span></span></span></code></pre></div><h2 id="4-15-平衡树rope">4-15 平衡树Rope</h2>
<p>头部</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;bits/extc++.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> __gnu_cxx;
</span></span></code></pre></div><p>创建</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>rope<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> rp;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// rope的下标是从 0 开始的
</span></span></span></code></pre></div><p>常用函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>rp.push_back(x); <span style="color:#75715e">//尾部加上元素x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>rp.replace(j, x); 
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 把下标为 j 的元素换成 x ,如果 j ≥ rp.size() 会变成 push_back(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>rp.insert(j, x);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 在下标为 j 的元素左边, 下标为 j - 1 的元素的右边, 插入 x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 如果 j ≥ rp.size() 会变成 push_back(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> a[N];
</span></span><span style="display:flex;"><span>rp.insert(j, a, len);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 在下标为 j 的元素左边, 下标为 j - 1 的元素的右边, 插入数组 a 的前 len 个数, len ＞ N 会出问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 初始化的时候, 这样比每次 push_back 快
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>rp.erase(j, len); <span style="color:#75715e">// 从下标 j 开始, 删除 len 个数, 没有 len 会直接删到结尾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>rp.substr(j, len); 
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 将下标为 j 开始的,长度为 len 的子段 取出来, 返回一个 rope&lt;int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 如果 len 太大, 会出问题, 如果 j 太大, 返回空的 rope&lt;int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>rp[j]; rp.at(j);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 返回下标为 j 的元素, 但不是引用, 不能作为左值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>rp <span style="color:#f92672">=</span> rp1 <span style="color:#f92672">+</span> rp2; <span style="color:#75715e">// + 可以实现直接拼接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>rope<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">*</span>rp[N]; <span style="color:#75715e">// 准备实现可持久化 -&gt; 创建 N 个rope
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>rp[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> rope<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span>(); <span style="color:#75715e">// 初始版本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>rp[i] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> rope<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span>(<span style="color:#f92672">*</span>rp[v]); <span style="color:#75715e">// 创建 v 版本的副本作为新版本 i 版本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>rp[i] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">auto</span>(<span style="color:#f92672">*</span>rp[v]); <span style="color:#75715e">// 这样写也可以, 创建副本的操作是 O(1) 的
</span></span></span></code></pre></div><p>Rope 总体是 $O(N\sqrt N)$ 的</p>
<h2 id="4-16-rope实现可持久化并查集">4-16 Rope实现可持久化并查集</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> N <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>rope<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">*</span>rp[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">find</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> j) { <span style="color:#75715e">//查询版本 i 的 find(j)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> rpij <span style="color:#f92672">=</span> rp[i]<span style="color:#f92672">-&gt;</span>at(j);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (rpij <span style="color:#f92672">==</span> j)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> j;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> ans <span style="color:#f92672">=</span> find(i, rpij);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ans <span style="color:#f92672">!=</span> rpij) <span style="color:#75715e">//这个 if 非常重要!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        rp[i]<span style="color:#f92672">-&gt;</span>replace(j, ans);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Union</span>(<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> j, <span style="color:#66d9ef">int</span> k) { <span style="color:#75715e">// 在版本 i 下合成set(j)和set(k)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> fj <span style="color:#f92672">=</span> find(i, j), fk <span style="color:#f92672">=</span> find(i, k);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (fj <span style="color:#f92672">==</span> fk)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    rp[i]<span style="color:#f92672">-&gt;</span>replace(fk, fj);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-17-st表">4-17 ST表</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">T</span>, <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CMP</span> <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>less<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">RMQ</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> CMP cmp <span style="color:#f92672">=</span> CMP();
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span> ST;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    RMQ(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> a.size(), logn <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>__lg(n);
</span></span><span style="display:flex;"><span>        ST.assign(n, std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>(logn <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            ST[i][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> a[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> logn; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> (j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                ST[i][j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(ST[i][j], ST[i <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> j)][j], cmp);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    T <span style="color:#a6e22e">operator</span>()(<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> Log <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>__lg(r <span style="color:#f92672">-</span> l <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>min(ST[l][Log], ST[r <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> Log) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][Log], cmp);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="4-18-手写哈希表">4-18 手写哈希表</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> u64 <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span>; <span style="color:#75715e">// 有的时候用u32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e6</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>; <span style="color:#75715e">// 自由调节
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">cpHash</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> hd[mod], val[mod <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>], nt[mod <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>], tot;
</span></span><span style="display:flex;"><span>    u64 to[mod <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">clear</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> tot; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> u <span style="color:#f92672">=</span> to[i] <span style="color:#f92672">%</span> mod;
</span></span><span style="display:flex;"><span>            hd[u] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        tot <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">operator</span>[](u64 x) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> u <span style="color:#f92672">=</span> x <span style="color:#f92672">%</span> mod;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> hd[u]; i; i <span style="color:#f92672">=</span> nt[i])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (to[i] <span style="color:#f92672">==</span> x)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> val[i];
</span></span><span style="display:flex;"><span>        to[<span style="color:#f92672">++</span>tot] <span style="color:#f92672">=</span> x;
</span></span><span style="display:flex;"><span>        nt[tot] <span style="color:#f92672">=</span> hd[u];
</span></span><span style="display:flex;"><span>        hd[u] <span style="color:#f92672">=</span> tot;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> val[tot] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} mp;
</span></span></code></pre></div><h2 id="4-19-fhq-treap">4-19 fhq Treap</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include&lt;iostream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include&lt;queue&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include&lt;ctime&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include&lt;random&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define ET &#39;\n&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> N<span style="color:#f92672">=</span><span style="color:#ae81ff">100005</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Treap</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> INF;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> Root,cnt;
</span></span><span style="display:flex;"><span>	deque<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span>del_list;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span>
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> ch[<span style="color:#ae81ff">2</span>],v,rnd,siz;
</span></span><span style="display:flex;"><span>	}node[N];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">newNode</span>(<span style="color:#66d9ef">int</span> x)<span style="color:#75715e">//申请新节点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> tmp;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(del_list.empty()) tmp<span style="color:#f92672">=++</span>cnt;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span> tmp<span style="color:#f92672">=</span>del_list.front(),del_list.pop_front();
</span></span><span style="display:flex;"><span>		node[tmp].rnd<span style="color:#f92672">=</span>rand(),node[tmp].v<span style="color:#f92672">=</span>x,node[tmp].siz<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,node[tmp].ch[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">=</span>node[tmp].ch[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> tmp;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span>(<span style="color:#66d9ef">int</span> x)<span style="color:#75715e">//更新信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		node[x].siz<span style="color:#f92672">=</span>node[node[x].ch[<span style="color:#ae81ff">0</span>]].siz<span style="color:#f92672">+</span>node[node[x].ch[<span style="color:#ae81ff">1</span>]].siz<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">vsplit</span>(<span style="color:#66d9ef">int</span> pos,<span style="color:#66d9ef">int</span> v,<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>x,<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>y)<span style="color:#75715e">//按权值分裂
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>pos)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			x<span style="color:#f92672">=</span>y<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(node[pos].v<span style="color:#f92672">&lt;=</span>v) x<span style="color:#f92672">=</span>pos,vsplit(node[pos].ch[<span style="color:#ae81ff">1</span>],v,node[pos].ch[<span style="color:#ae81ff">1</span>],y);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span> y<span style="color:#f92672">=</span>pos,vsplit(node[pos].ch[<span style="color:#ae81ff">0</span>],v,x,node[pos].ch[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>		update(pos);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ssplit</span>(<span style="color:#66d9ef">int</span> pos,<span style="color:#66d9ef">int</span> k,<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>x,<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>y)<span style="color:#75715e">//按size分裂
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>pos)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			x<span style="color:#f92672">=</span>y<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(k<span style="color:#f92672">&gt;</span>node[node[pos].ch[<span style="color:#ae81ff">0</span>]].siz)
</span></span><span style="display:flex;"><span>			x<span style="color:#f92672">=</span>pos,ssplit(node[pos].ch[<span style="color:#ae81ff">1</span>],k<span style="color:#f92672">-</span>node[node[pos].ch[<span style="color:#ae81ff">0</span>]].siz<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,node[pos].ch[<span style="color:#ae81ff">1</span>],y);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span> y<span style="color:#f92672">=</span>pos,ssplit(node[pos].ch[<span style="color:#ae81ff">0</span>],k,x,node[pos].ch[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>		update(pos);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">merge</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)<span style="color:#75715e">//合并
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>x<span style="color:#f92672">||!</span>y) <span style="color:#66d9ef">return</span> x<span style="color:#f92672">+</span>y;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span>(node[x].rnd<span style="color:#f92672">&lt;</span>node[y].rnd)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			node[x].ch[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">=</span>merge(node[x].ch[<span style="color:#ae81ff">1</span>],y);
</span></span><span style="display:flex;"><span>			update(x);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> x;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		node[y].ch[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">=</span>merge(x,node[y].ch[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>		update(y);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> y;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert</span>(<span style="color:#66d9ef">int</span> v)<span style="color:#75715e">//插入
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> x,y;
</span></span><span style="display:flex;"><span>		vsplit(Root,v,x,y);
</span></span><span style="display:flex;"><span>		Root<span style="color:#f92672">=</span>merge(merge(x,newNode(v)),y);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">erase</span>(<span style="color:#66d9ef">int</span> v)<span style="color:#75715e">//删除
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> x,y,z;
</span></span><span style="display:flex;"><span>		vsplit(Root,v,x,z);
</span></span><span style="display:flex;"><span>		vsplit(x,v<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,x,y);
</span></span><span style="display:flex;"><span>		del_list.push_back(y);
</span></span><span style="display:flex;"><span>		y<span style="color:#f92672">=</span>merge(node[y].ch[<span style="color:#ae81ff">0</span>],node[y].ch[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>		Root<span style="color:#f92672">=</span>merge(merge(x,y),z);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">pre</span>(<span style="color:#66d9ef">int</span> v)<span style="color:#75715e">//前驱
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> x,y,cur;
</span></span><span style="display:flex;"><span>		vsplit(Root,v<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,x,y);
</span></span><span style="display:flex;"><span>		cur<span style="color:#f92672">=</span>x;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">while</span>(node[cur].ch[<span style="color:#ae81ff">1</span>]) cur<span style="color:#f92672">=</span>node[cur].ch[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>		merge(x,y);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> node[cur].v;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">nxt</span>(<span style="color:#66d9ef">int</span> v)<span style="color:#75715e">//后继
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> x,y,cur;
</span></span><span style="display:flex;"><span>		vsplit(Root,v,x,y);
</span></span><span style="display:flex;"><span>		cur<span style="color:#f92672">=</span>y;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">while</span>(node[cur].ch[<span style="color:#ae81ff">0</span>]) cur<span style="color:#f92672">=</span>node[cur].ch[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>		merge(x,y);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> node[cur].v;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get_rank</span>(<span style="color:#66d9ef">int</span> v)<span style="color:#75715e">//查排名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> x,y,ans;
</span></span><span style="display:flex;"><span>		vsplit(Root,v<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,x,y);
</span></span><span style="display:flex;"><span>		ans<span style="color:#f92672">=</span>node[x].siz;
</span></span><span style="display:flex;"><span>		merge(x,y);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">kth</span>(<span style="color:#66d9ef">int</span> k)<span style="color:#75715e">//查排名为k的数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>k;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> x,y,cur;
</span></span><span style="display:flex;"><span>		ssplit(Root,k,x,y);
</span></span><span style="display:flex;"><span>		cur<span style="color:#f92672">=</span>x;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">while</span>(node[cur].ch[<span style="color:#ae81ff">1</span>]) cur<span style="color:#f92672">=</span>node[cur].ch[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>		merge(x,y);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> node[cur].v;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	Treap()<span style="color:#f92672">:</span>INF(<span style="color:#ae81ff">2147483647</span>)<span style="color:#75715e">//构造函数初始化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	{
</span></span><span style="display:flex;"><span>		Root<span style="color:#f92672">=</span>cnt<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		insert(<span style="color:#f92672">-</span>INF),insert(INF);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>    ios<span style="color:#f92672">::</span>sync_with_stdio(<span style="color:#ae81ff">0</span>);cin.tie(<span style="color:#ae81ff">0</span>);cout.tie(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    Treap T;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n,t,x;
</span></span><span style="display:flex;"><span>    cin<span style="color:#f92672">&gt;&gt;</span>n;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span>(n<span style="color:#f92672">--</span>){
</span></span><span style="display:flex;"><span>        cin<span style="color:#f92672">&gt;&gt;</span>t<span style="color:#f92672">&gt;&gt;</span>x;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(t<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>)cout<span style="color:#f92672">&lt;&lt;</span>T.get_rank(x)<span style="color:#f92672">&lt;&lt;</span>ET;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(t<span style="color:#f92672">==</span><span style="color:#ae81ff">2</span>)cout<span style="color:#f92672">&lt;&lt;</span>T.kth(x)<span style="color:#f92672">&lt;&lt;</span>ET;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(t<span style="color:#f92672">==</span><span style="color:#ae81ff">3</span>)cout<span style="color:#f92672">&lt;&lt;</span>T.pre(x)<span style="color:#f92672">&lt;&lt;</span>ET;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(t<span style="color:#f92672">==</span><span style="color:#ae81ff">4</span>)cout<span style="color:#f92672">&lt;&lt;</span>T.nxt(x)<span style="color:#f92672">&lt;&lt;</span>ET;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> T.insert(x);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="5-树论">5, 树论</h1>
<h2 id="5-1-树上启发式合并">5-1 树上启发式合并</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//树上启发式合并 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dfs</span>(<span style="color:#66d9ef">int</span> i,<span style="color:#66d9ef">int</span> fa){
</span></span><span style="display:flex;"><span><span style="color:#75715e">//	先递归轻子树 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	if(当前节点有重子树){
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//		递归重子树 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	加上所有轻子树贡献 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	加上当前节点贡献 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	统计当前节点答案 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	if(当前节点是自己父节点的重儿子)return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	else 删除当前这棵树的贡献
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="5-2-树剖lca">5-2 树剖LCA</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">T</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Lca</span> {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">&amp;</span>e;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> size, big, dep, tp, fa;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n;
</span></span><span style="display:flex;"><span>    Lca(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">&amp;</span>g)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span> e(g), n(g.size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>), tp(g.size()), big(g.size()),
</span></span><span style="display:flex;"><span>          size(g.size()), dep(g.size()), fa(g.size()) {
</span></span><span style="display:flex;"><span>        dfs1(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        dfs2(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dfs1</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> f) {
</span></span><span style="display:flex;"><span>        dep[x] <span style="color:#f92672">=</span> dep[f] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        size[x] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        fa[x] <span style="color:#f92672">=</span> f;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> y : e[x]) <span style="color:#75715e">// 有权图 换成 auto [y, w]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">!=</span> f) {
</span></span><span style="display:flex;"><span>                dfs1(y, x);
</span></span><span style="display:flex;"><span>                size[x] <span style="color:#f92672">+=</span> size[y];
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (size[y] <span style="color:#f92672">&gt;</span> size[big[x]])
</span></span><span style="display:flex;"><span>                    big[x] <span style="color:#f92672">=</span> y;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dfs2</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> top) {
</span></span><span style="display:flex;"><span>        tp[x] <span style="color:#f92672">=</span> top;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (big[x])
</span></span><span style="display:flex;"><span>            dfs2(big[x], top);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> y : e[x]) <span style="color:#75715e">// 有权图 换成 auto [y, w]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">!=</span> big[x] and y <span style="color:#f92672">!=</span> fa[x])
</span></span><span style="display:flex;"><span>                dfs2(y, y);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getLca</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (tp[x] <span style="color:#f92672">!=</span> tp[y])
</span></span><span style="display:flex;"><span>            (dep[tp[x]] <span style="color:#f92672">&gt;</span> dep[tp[y]] <span style="color:#f92672">?</span> x <span style="color:#f92672">=</span> fa[tp[x]] <span style="color:#f92672">:</span> y <span style="color:#f92672">=</span> fa[tp[y]]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (dep[x] <span style="color:#f92672">&lt;</span> dep[y] <span style="color:#f92672">?</span> x : y);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">dist</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> L <span style="color:#f92672">=</span> getLca(x, y);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> dep[x] <span style="color:#f92672">+</span> dep[y] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dep[L];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="5-3-倍增lca">5-3 倍增LCA</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> n, m, s, tot;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> lg; <span style="color:#75715e">// lg=std::__lg(n)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> e[N];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> dep[N], f[N][<span style="color:#ae81ff">19</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dfs</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">&amp;</span> i,<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">&amp;</span> fa) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j : e[i]) {
</span></span><span style="display:flex;"><span>        f[j][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>        dep[j] <span style="color:#f92672">=</span> dep[i] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; k <span style="color:#f92672">&lt;=</span> lg; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            f[j][k] <span style="color:#f92672">=</span> f[f[j][k <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]][k <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>f[j][k]) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        dfs(to[j], i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">lca</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (dep[x] <span style="color:#f92672">&gt;</span> dep[y]) std<span style="color:#f92672">::</span>swap(x, y);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> lg; k <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; k<span style="color:#f92672">--</span>) 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (dep[f[y][k]] <span style="color:#f92672">&gt;=</span> dep[x])
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> f[y][k];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">==</span> y)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> lg; k <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; k<span style="color:#f92672">--</span>) 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (f[x][k] <span style="color:#f92672">!=</span> f[y][k])
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">=</span> f[x][k], y <span style="color:#f92672">=</span> f[y][k];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> f[x][<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//注意这里lg=__lg(n)
</span></span></span></code></pre></div><p>复杂度： $O(nlogn)$预处理 $O(logn)$查询</p>
<!-- raw HTML omitted -->
<h1 id="6-图论">6, 图论</h1>
<h2 id="6-1-单源最短路">6-1 单源最短路</h2>
<h3 id="6-1-1-spfa">6-1-1 spfa</h3>
<p>复杂度 最坏 $O(nm)$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">spfa</span>(<span style="color:#66d9ef">int</span> s) {
</span></span><span style="display:flex;"><span>    memset(cnt, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span> cnt);
</span></span><span style="display:flex;"><span>    dis[s] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    v[s] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>queue<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> q;
</span></span><span style="display:flex;"><span>    q.push(s);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>q.empty()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> q.front();
</span></span><span style="display:flex;"><span>        q.pop();
</span></span><span style="display:flex;"><span>        v[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [j, len] <span style="color:#f92672">:</span> e[i]) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (dis[j] <span style="color:#f92672">&gt;</span> dis[i] <span style="color:#f92672">+</span> len) {
</span></span><span style="display:flex;"><span>                dis[j] <span style="color:#f92672">=</span> dis[i] <span style="color:#f92672">+</span> len;
</span></span><span style="display:flex;"><span>                cnt[j] <span style="color:#f92672">=</span> cnt[i] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//到to点的最短路边数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (cnt[j] <span style="color:#f92672">&gt;=</span> n)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span>; <span style="color:#75715e">//边数大于n 说明有负环
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>v[j])
</span></span><span style="display:flex;"><span>                    q.push(j), v[j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="6-1-2-dijkstra非负权图">6-1-2 Dijkstra（非负权图）</h3>
<p>复杂度 $O((n+m)\log n)$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">auto</span> dijkstra <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> s) {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>i64<span style="color:#f92672">&gt;</span> dis(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">30</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define pii std::pair&lt;i64, int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>priority_queue<span style="color:#f92672">&lt;</span>pii, std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>pii<span style="color:#f92672">&gt;</span>, std<span style="color:#f92672">::</span>greater<span style="color:#f92672">&lt;&gt;&gt;</span> q;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dis[s] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    q.push({<span style="color:#ae81ff">0</span>, s});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>q.empty()) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> [D, x] <span style="color:#f92672">=</span> q.top();
</span></span><span style="display:flex;"><span>        q.pop();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (D <span style="color:#f92672">&gt;</span> dis[x])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [y, w] <span style="color:#f92672">:</span> e[x])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (dis[y] <span style="color:#f92672">&gt;</span> dis[x] <span style="color:#f92672">+</span> w) {
</span></span><span style="display:flex;"><span>                dis[y] <span style="color:#f92672">==</span> dis[x] <span style="color:#f92672">+</span> w;
</span></span><span style="display:flex;"><span>                q.push({dis[y], y});
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> dis;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="6-2-基环树预处理">6-2 基环树预处理</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;&gt;</span> g;
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> cycle;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RingTree</span>(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>set<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">&amp;</span>e) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> e.size(); <span style="color:#75715e">// m = n + 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    g.assign(m, {});
</span></span><span style="display:flex;"><span>    cycle.clear();
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> vis(m, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>function<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">void</span>(<span style="color:#66d9ef">int</span>)<span style="color:#f92672">&gt;</span> dfs1 <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>        vis[x] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>e[x].begin();
</span></span><span style="display:flex;"><span>        e[x].erase(y);
</span></span><span style="display:flex;"><span>        e[y].erase(x);
</span></span><span style="display:flex;"><span>        g[y].push_back(x);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e[y].size() <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            dfs1(y);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> m; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e[i].size() <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            dfs1(i);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>function<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">void</span>(<span style="color:#66d9ef">int</span>)<span style="color:#f92672">&gt;</span> dfs2 <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> x) {
</span></span><span style="display:flex;"><span>        cycle.push_back(x);
</span></span><span style="display:flex;"><span>        vis[x] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> y : e[x])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>vis[y])
</span></span><span style="display:flex;"><span>                dfs2(y);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> m; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (vis[i] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            dfs2(i);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="6-3-最大流">6-3 最大流</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">template</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">T</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">flow</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">E</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> to;
</span></span><span style="display:flex;"><span>        T cap;
</span></span><span style="display:flex;"><span>        E(<span style="color:#66d9ef">int</span> to, T cap) <span style="color:#f92672">:</span> to(to), cap(cap) {}
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> n;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> e;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;&gt;</span> g;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> cur, h;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    flow(<span style="color:#66d9ef">int</span> n) <span style="color:#f92672">:</span> n(n), g(n) {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">bfs</span>(<span style="color:#66d9ef">int</span> s, <span style="color:#66d9ef">int</span> t) {
</span></span><span style="display:flex;"><span>        h.assign(n, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>queue<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> q;
</span></span><span style="display:flex;"><span>        h[s] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        q.push(s);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>q.empty()) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> u <span style="color:#f92672">=</span> q.front();
</span></span><span style="display:flex;"><span>            q.pop();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i : g[u]) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">auto</span> [v, c] <span style="color:#f92672">=</span> e[i];
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (c <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> h[v] <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>                    h[v] <span style="color:#f92672">=</span> h[u] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">==</span> t)
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>                    q.push(v);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    T <span style="color:#a6e22e">dfs</span>(<span style="color:#66d9ef">int</span> u, <span style="color:#66d9ef">int</span> t, T f) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (u <span style="color:#f92672">==</span> t)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> f;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> r <span style="color:#f92672">=</span> f;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>i <span style="color:#f92672">=</span> cur[u]; i <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">int</span>(g[u].size()); <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> g[u][i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> [v, c] <span style="color:#f92672">=</span> e[j];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (c <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> h[v] <span style="color:#f92672">==</span> h[u] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">auto</span> a <span style="color:#f92672">=</span> dfs(v, t, std<span style="color:#f92672">::</span>min(r, c));
</span></span><span style="display:flex;"><span>                e[j].cap <span style="color:#f92672">-=</span> a;
</span></span><span style="display:flex;"><span>                e[j <span style="color:#f92672">^</span> <span style="color:#ae81ff">1</span>].cap <span style="color:#f92672">+=</span> a;
</span></span><span style="display:flex;"><span>                r <span style="color:#f92672">-=</span> a;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> f;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> f <span style="color:#f92672">-</span> r;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> u, <span style="color:#66d9ef">int</span> v, T c) {
</span></span><span style="display:flex;"><span>        g[u].push_back(e.size());
</span></span><span style="display:flex;"><span>        e.emplace_back(v, c);
</span></span><span style="display:flex;"><span>        g[v].push_back(e.size());
</span></span><span style="display:flex;"><span>        e.emplace_back(u, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    T <span style="color:#a6e22e">work</span>(<span style="color:#66d9ef">int</span> s, <span style="color:#66d9ef">int</span> t) {
</span></span><span style="display:flex;"><span>        T ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (bfs(s, t)) {
</span></span><span style="display:flex;"><span>            cur.assign(n, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">+=</span> dfs(s, t, std<span style="color:#f92672">::</span>numeric_limits<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;::</span>max());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 用法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// flow&lt;int&gt; f(n + 1);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// for (int u, v, w, i = 0; i &lt; m; i++) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     std::cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     f.add(u, v, w);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// auto ans = f.work(s, t);
</span></span></span></code></pre></div><!-- raw HTML omitted -->
<h1 id="7-计算几何">7, 计算几何</h1>
<!-- raw HTML omitted -->
<h2 id="7-1-基础部分">7-1 基础部分</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 如果题目输出浮点数,还没有SPJ,务必检查会不会输出 -0.000的情况
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> ld eps <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e-9</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> ld pi <span style="color:#f92672">=</span> acosl(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">sgn</span>(<span style="color:#66d9ef">const</span> ld <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span>eps <span style="color:#f92672">?</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> a <span style="color:#f92672">&gt;</span> eps);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define pii std::pair&lt;int,int&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define x first
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define y second
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pii <span style="color:#66d9ef">operator</span><span style="color:#f92672">+</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a.x <span style="color:#f92672">+</span> b.x, a.y <span style="color:#f92672">+</span> b.y};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a.x <span style="color:#f92672">-</span> b.x, a.y <span style="color:#f92672">-</span> b.y};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>i64 <span style="color:#66d9ef">operator</span><span style="color:#f92672">*</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a.x <span style="color:#f92672">*</span> b.x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a.y <span style="color:#f92672">*</span> b.y;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#66d9ef">operator</span><span style="color:#f92672">*</span>(<span style="color:#66d9ef">const</span> ld <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a <span style="color:#f92672">*</span> b.x, a <span style="color:#f92672">*</span> b.y};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>i64 <span style="color:#66d9ef">operator</span><span style="color:#f92672">%</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a.x <span style="color:#f92672">*</span> b.y <span style="color:#f92672">-</span> <span style="color:#ae81ff">1ll</span> <span style="color:#f92672">*</span> a.y <span style="color:#f92672">*</span> b.x;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#a6e22e">rot</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> ld <span style="color:#f92672">&amp;</span>th) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 逆时针旋转 th rad
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 复数乘法 (a.x+a.yi)*(b.x+b.yi)=a.x*b.x-a.y*b.y+(a.x*b.y+a.y*b.x)i
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    pii b <span style="color:#f92672">=</span> {cosl(th), sinl(th)};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a.x <span style="color:#f92672">*</span> b.x <span style="color:#f92672">-</span> a.y <span style="color:#f92672">*</span> b.y, a.x <span style="color:#f92672">*</span> b.y <span style="color:#f92672">+</span> a.y <span style="color:#f92672">*</span> b.x};
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-2-点与点">7-2 点与点</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>i64 <span style="color:#a6e22e">dis2</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> p <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p <span style="color:#f92672">*</span> p;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>ld <span style="color:#a6e22e">dis</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>}) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> p <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sqrtl(p <span style="color:#f92672">*</span> p);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-3-点与线">7-3 点与线</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">onSeg</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, pii b, pii c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a on Seg b-c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    b <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a, c <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (b <span style="color:#f92672">%</span> c <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> and b <span style="color:#f92672">*</span> c <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>ld <span style="color:#a6e22e">disLine</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a to line b-c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> v1 <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> c, v2 <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> c;
</span></span><span style="display:flex;"><span>    ld ans <span style="color:#f92672">=</span> (ld)std<span style="color:#f92672">::</span>abs(v1 <span style="color:#f92672">%</span> v2) <span style="color:#f92672">/</span> sqrt(v1 <span style="color:#f92672">*</span> v1);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>ld <span style="color:#a6e22e">disSeg</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a to seg b-c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> ((a <span style="color:#f92672">-</span> b) <span style="color:#f92672">*</span> (c <span style="color:#f92672">-</span> b) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> or (a <span style="color:#f92672">-</span> c) <span style="color:#f92672">*</span> (b <span style="color:#f92672">-</span> c) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> std<span style="color:#f92672">::</span>min(dis(a, b), dis(a, c));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> disLine(a, b, c);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#a6e22e">foot</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这里的 pii 是pair&lt;ld, ld&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// point a project to Line b-c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> u <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> b, v <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> b;
</span></span><span style="display:flex;"><span>    ld rate <span style="color:#f92672">=</span> (u <span style="color:#f92672">*</span> v) <span style="color:#f92672">/</span> (v <span style="color:#f92672">*</span> v);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> b <span style="color:#f92672">+</span> rate <span style="color:#f92672">*</span> v; <span style="color:#75715e">// 有个数乘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#a6e22e">symmetry</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这里的 pii 是pair&lt;ld, ld&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// point a symmetry to Line b-c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> ft <span style="color:#f92672">=</span> foot(a, b, c);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> ft <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-4-线与线">7-4 线与线</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 直线相交
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pii <span style="color:#a6e22e">cross</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>d) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// line a-b 交 line c-d
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 这里的 pii 是 pair&lt;ld, ld&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> v <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> d;
</span></span><span style="display:flex;"><span>    ld sa <span style="color:#f92672">=</span> v <span style="color:#f92672">%</span> (a <span style="color:#f92672">-</span> d), sb <span style="color:#f92672">=</span> (b <span style="color:#f92672">-</span> d) <span style="color:#f92672">%</span> v;
</span></span><span style="display:flex;"><span>    ld rate <span style="color:#f92672">=</span> sa <span style="color:#f92672">/</span> (sa <span style="color:#f92672">+</span> sb);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> rate <span style="color:#f92672">*</span> (b <span style="color:#f92672">-</span> a) <span style="color:#f92672">+</span> a;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 求向量夹角 tan
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ld <span style="color:#a6e22e">angle</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a-b 和 a-c 的夹角tan 的绝对值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> v1 <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a, v2 <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (v1 <span style="color:#f92672">*</span> v2 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// 表示v1和v2垂直
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> (ld)(v1 <span style="color:#f92672">%</span> v2) <span style="color:#f92672">/</span> (v1 <span style="color:#f92672">*</span> v2);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-5-求凸包">7-5 求凸包</h2>
<p>$O(n\log n)$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">convex</span>(pii <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>n) { <span style="color:#75715e">//大小为 n 的 pii 集合
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>sort(p, p <span style="color:#f92672">+</span> n);      <span style="color:#75715e">//为了取最左下角点 p[0]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    n <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>unique(p, p <span style="color:#f92672">+</span> n) <span style="color:#f92672">-</span> p;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">return</span>; <span style="color:#75715e">// 不写这个 会RE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> cmp <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> A <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>], B <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (A <span style="color:#f92672">%</span> B <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> dis2(A) <span style="color:#f92672">&lt;</span> dis2(B) <span style="color:#f92672">:</span> A <span style="color:#f92672">%</span> B <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>sort(p <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, p <span style="color:#f92672">+</span> n, cmp); <span style="color:#75715e">//注意要 p+1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>pii<span style="color:#f92672">&gt;</span> qw(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, p[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> n; qw[<span style="color:#f92672">++</span>r] <span style="color:#f92672">=</span> p[i], i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (r and (qw[r] <span style="color:#f92672">-</span> qw[r <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]) <span style="color:#f92672">%</span> (p[i] <span style="color:#f92672">-</span> qw[r]) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            r<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> r; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        p[i] <span style="color:#f92672">=</span> qw[i];
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e">//一定要重设 n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    p[n] <span style="color:#f92672">=</span> p[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// 把点集 p 改成凸包点集
</span></span></span></code></pre></div><h2 id="7-6-点在不在多边形内">7-6 点在不在多边形内</h2>
<p>$O(n)$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">onSeg</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, pii b, pii c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a on Seg b-c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    b <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a, c <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (b <span style="color:#f92672">%</span> c <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> and b <span style="color:#f92672">*</span> c <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">sgn</span>(<span style="color:#66d9ef">const</span> i64 <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> a <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">isCross</span>(pii a, pii b, pii c, pii d) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Seg c-d is Cross Seg a-b
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> ab <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a, cd <span style="color:#f92672">=</span> d <span style="color:#f92672">-</span> c;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ab <span style="color:#f92672">%</span> cd <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// 共线判寄
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> r1 <span style="color:#f92672">=</span> sgn(ab <span style="color:#f92672">%</span> (c <span style="color:#f92672">-</span> a)), r2 <span style="color:#f92672">=</span> sgn(ab <span style="color:#f92672">%</span> (d <span style="color:#f92672">-</span> a));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> t1 <span style="color:#f92672">=</span> sgn(cd <span style="color:#f92672">%</span> (a <span style="color:#f92672">-</span> c)), t2 <span style="color:#f92672">=</span> sgn(cd <span style="color:#f92672">%</span> (b <span style="color:#f92672">-</span> c));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">!</span>(r1 <span style="color:#f92672">*</span> r2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> or r1 <span style="color:#f92672">+</span> r2 <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> or t1 <span style="color:#f92672">*</span> t2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 真相交或者 c-d 贴着 a-b 左边
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string inPoly(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, pii <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 判断 a 点在多边形 p 的内/上/外
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> res <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    pii b <span style="color:#f92672">=</span> {<span style="color:#66d9ef">int</span>(<span style="color:#ae81ff">1e9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>), a.y};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) { <span style="color:#75715e">// 这里要有 p[n] = p[0]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (onSeg(a, p[i], p[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>])) <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ON&#34;</span>;
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">+=</span> isCross(a, b, p[i], p[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (res <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;IN&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OUT&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-7-点在不在凸包内">7-7 点在不在凸包内</h2>
<p>$O (\log n)$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">onSeg</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, pii b, pii c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a on Seg b-c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    b <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a, c <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (b <span style="color:#f92672">%</span> c <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> and b <span style="color:#f92672">*</span> c <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string inConvex(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, pii <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 判断 a 点在凸包 p 的内/上/外
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (a <span style="color:#f92672">==</span> p[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ON&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> v <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((p[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">%</span> v <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> or (p[n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">%</span> v <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;OUT&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> l <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, r <span style="color:#f92672">=</span> n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (l <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span> r) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        i64 cs <span style="color:#f92672">=</span> (p[mid] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">%</span> v;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (cs <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> (p[mid] <span style="color:#f92672">==</span> a <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;ON&#34;</span> <span style="color:#f92672">:</span> (onSeg(a, p[<span style="color:#ae81ff">0</span>], p[mid]) <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;IN&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OUT&#34;</span>));
</span></span><span style="display:flex;"><span>        (cs <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> l : r) <span style="color:#f92672">=</span> mid;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    i64 cs <span style="color:#f92672">=</span> (p[r] <span style="color:#f92672">-</span> p[l]) <span style="color:#f92672">%</span> (a <span style="color:#f92672">-</span> p[l]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (cs <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> or onSeg(a, p[<span style="color:#ae81ff">0</span>], p[l]) or onSeg(a, p[<span style="color:#ae81ff">0</span>], p[r]))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;ON&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (cs <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;IN&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OUT&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-8-直线和凸包关系">7-8 直线和凸包关系</h2>
<p>$O(n)$ 预处理 $O(\log n)$ 查询</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> ld pi <span style="color:#f92672">=</span> acosl(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>ld <span style="color:#a6e22e">fix</span>(<span style="color:#66d9ef">const</span> ld <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (a <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">1.5</span> <span style="color:#f92672">*</span> pi)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> a <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> pi <span style="color:#f92672">?</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi : a);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">sgn</span>(<span style="color:#66d9ef">const</span> i64 <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> a <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> N <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string crossConvex(pii u, pii v, pii <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 判断直线 u-v 和凸包 p 的相交情况
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;OUT&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ((u <span style="color:#f92672">-</span> v) <span style="color:#f92672">%</span> (p[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> v) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;ON&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OUT&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> ld ag[N]; <span style="color:#75715e">// 把 N 写在函数前
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> Capps <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>] {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 预处理边的倾角, 多个凸包的话不能这么写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> w <span style="color:#f92672">=</span> p[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[i];
</span></span><span style="display:flex;"><span>            ag[i] <span style="color:#f92672">=</span> fix(atan2l(w.y, w.x));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> b <span style="color:#f92672">=</span> u <span style="color:#f92672">-</span> v;
</span></span><span style="display:flex;"><span>    ld th <span style="color:#f92672">=</span> fix(atan2l(b.y, b.x));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>lower_bound(ag, ag <span style="color:#f92672">+</span> n, th) <span style="color:#f92672">-</span> ag;
</span></span><span style="display:flex;"><span>    th <span style="color:#f92672">=</span> fix(th <span style="color:#f92672">+</span> pi);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>lower_bound(ag, ag <span style="color:#f92672">+</span> n, th) <span style="color:#f92672">-</span> ag;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> r1 <span style="color:#f92672">=</span> sgn(b <span style="color:#f92672">%</span> (p[i] <span style="color:#f92672">-</span> v)), r2 <span style="color:#f92672">=</span> sgn(b <span style="color:#f92672">%</span> (p[j] <span style="color:#f92672">-</span> v));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r1 <span style="color:#f92672">*</span> r2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;OUT&#34;</span> <span style="color:#f92672">:</span> (r1 <span style="color:#f92672">*</span> r2 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;IN&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;ON&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-9-直线切多边形">7-9 直线切多边形</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">cutPoly</span>(pii <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>n, pii a, pii b) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 把多边形 p 在有向直线 a-&gt;b 左边的部分切开留下 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>pii<span style="color:#f92672">&gt;</span> v;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> c <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> cr1 <span style="color:#f92672">=</span> c <span style="color:#f92672">%</span> (p[i] <span style="color:#f92672">-</span> a), cr2 <span style="color:#f92672">=</span> c <span style="color:#f92672">%</span> (p[(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> n] <span style="color:#f92672">-</span> a);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (sgn(cr1) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            v.push_back(p[i]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (sgn(cr1) <span style="color:#f92672">*</span> sgn(cr2) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            v.push_back(cross(a, b, p[i], p[(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> n]));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> po : v)
</span></span><span style="display:flex;"><span>        p[n<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> po;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-10-闵可夫斯基和">7-10 闵可夫斯基和</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Minkowski</span>(pii <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> n, pii <span style="color:#f92672">*</span>b, <span style="color:#66d9ef">int</span> m, pii <span style="color:#f92672">*</span>c, <span style="color:#66d9ef">int</span> <span style="color:#f92672">&amp;</span>s) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 闵可夫斯基和求两凸包的和, 以长度为 s 的 c 数组返回
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> a[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> b[<span style="color:#ae81ff">0</span>], s <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (i <span style="color:#f92672">&lt;</span> n and j <span style="color:#f92672">&lt;</span> m)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((a[(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> n] <span style="color:#f92672">-</span> a[i]) <span style="color:#f92672">%</span> (b[(j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> m] <span style="color:#f92672">-</span> b[j]) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            c[s] <span style="color:#f92672">=</span> c[s <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> a[(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> n] <span style="color:#f92672">-</span> a[i], s<span style="color:#f92672">++</span>, i<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            c[s] <span style="color:#f92672">=</span> c[s <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> b[(j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> m] <span style="color:#f92672">-</span> b[j], s<span style="color:#f92672">++</span>, j<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (i <span style="color:#f92672">&lt;</span> n)
</span></span><span style="display:flex;"><span>        c[s] <span style="color:#f92672">=</span> c[s <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> a[(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> n] <span style="color:#f92672">-</span> a[i], s<span style="color:#f92672">++</span>, i<span style="color:#f92672">++</span>; <span style="color:#75715e">// copy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> (j <span style="color:#f92672">&lt;</span> m)
</span></span><span style="display:flex;"><span>        c[s] <span style="color:#f92672">=</span> c[s <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> b[(j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> m] <span style="color:#f92672">-</span> b[j], s<span style="color:#f92672">++</span>, j<span style="color:#f92672">++</span>; <span style="color:#75715e">// copy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    convex(c, s);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-11-夹角和四点共圆">7-11 夹角和四点共圆</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define pll std::pair&lt;i64, i64&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>pll <span style="color:#a6e22e">angle</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// a-b 和 a-c 的夹角 tan
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> v1 <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a, v2 <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (v1 <span style="color:#f92672">*</span> v2 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>};             <span style="color:#75715e">// 表示v1和v2垂直
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> {(v1 <span style="color:#f92672">%</span> v2), (v1 <span style="color:#f92672">*</span> v2)}; <span style="color:#75715e">// tan∠bac
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">conCircle</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>d) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 对四个不同的点判断四点共圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> ((a <span style="color:#f92672">-</span> b) <span style="color:#f92672">%</span> (a <span style="color:#f92672">-</span> c) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> or (d <span style="color:#f92672">-</span> c) <span style="color:#f92672">%</span> (d <span style="color:#f92672">-</span> b) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> a1 <span style="color:#f92672">=</span> angle(a, b, c), a2 <span style="color:#f92672">=</span> angle(d, c, b);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ((__int128)a1.x <span style="color:#f92672">*</span> a2.y <span style="color:#f92672">+</span> (__int128)a1.y <span style="color:#f92672">*</span> a2.x) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-12-平面最近点对">7-12 平面最近点对</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>ld <span style="color:#a6e22e">Closest</span>(pii <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">int</span> n) {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>sort(p, p <span style="color:#f92672">+</span> n); <span style="color:#75715e">// 把点按 x 排序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ld ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e10</span>;       <span style="color:#75715e">// 整点则ans存dis2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>function<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">void</span>(<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>)<span style="color:#f92672">&gt;</span> find <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> l, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">&lt;=</span> l)  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> l <span style="color:#f92672">+</span> r <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        find(l, mid); <span style="color:#75715e">// 分治下去
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        find(mid <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, r);
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>pii<span style="color:#f92672">&gt;</span> b; <span style="color:#75715e">// 存中间缝隙的点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> l; i <span style="color:#f92672">&lt;=</span> r; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (std<span style="color:#f92672">::</span>fabs(p[i].x <span style="color:#f92672">-</span> p[mid].x) <span style="color:#f92672">&lt;</span> ans) <span style="color:#75715e">// 整点则换成pf(Δx)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                b.push_back(p[i]);
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>sort(b.begin(), b.end(), [<span style="color:#f92672">&amp;</span>](pii u, pii v) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> u.y <span style="color:#f92672">&lt;</span> v.y; <span style="color:#75715e">// 按 y 排序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> b.size(); i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;</span> b.size() and b[j].y <span style="color:#f92672">-</span> b[i].y <span style="color:#f92672">&lt;</span> ans; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>                ans <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>min(ans, dis(b[j] <span style="color:#f92672">-</span> b[i])); <span style="color:#75715e">// 整点则条件变成pf(Δy)&lt;ans
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 答案只可能在这个夹缝里, 更新答案
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    };
</span></span><span style="display:flex;"><span>    find(<span style="color:#ae81ff">0</span>, n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>); <span style="color:#75715e">// 记得调用函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// O(nlog2n) 但几乎O(nlogn)
</span></span></span></code></pre></div><h2 id="7-13-最小圆覆盖">7-13 最小圆覆盖</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>ld <span style="color:#a6e22e">dis</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> p <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sqrtl(p.x <span style="color:#f92672">*</span> p.x <span style="color:#f92672">+</span> p.y <span style="color:#f92672">*</span> p.y);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#a6e22e">cross</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>d) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// line a-b 交 line c-d
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> v <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> d;
</span></span><span style="display:flex;"><span>    ld sa <span style="color:#f92672">=</span> v <span style="color:#f92672">%</span> (a <span style="color:#f92672">-</span> d), sb <span style="color:#f92672">=</span> (b <span style="color:#f92672">-</span> d) <span style="color:#f92672">%</span> v;
</span></span><span style="display:flex;"><span>    ld rate <span style="color:#f92672">=</span> sa <span style="color:#f92672">/</span> (sa <span style="color:#f92672">+</span> sb);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> rate <span style="color:#f92672">*</span> (b <span style="color:#f92672">-</span> a) <span style="color:#f92672">+</span> a;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#a6e22e">rot</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 逆时针旋转90度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> {<span style="color:#f92672">-</span>a.y, a.x};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#a6e22e">rot</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> ld <span style="color:#f92672">&amp;</span>th) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 逆时针旋转 th rad
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 复数乘法 (a.x+a.yi)*(b.x+b.yi)=a.x*b.x-a.y*b.y+(a.x*b.y+a.y*b.x)i
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    pii b <span style="color:#f92672">=</span> {cosl(th), sinl(th)};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {a.x <span style="color:#f92672">*</span> b.x <span style="color:#f92672">-</span> a.y <span style="color:#f92672">*</span> b.y, a.x <span style="color:#f92672">*</span> b.y <span style="color:#f92672">+</span> a.y <span style="color:#f92672">*</span> b.x};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pii <span style="color:#a6e22e">excir</span>(<span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>b, <span style="color:#66d9ef">const</span> pii <span style="color:#f92672">&amp;</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 三点求外接圆 圆心
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> d1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5f</span> <span style="color:#f92672">*</span> (a <span style="color:#f92672">+</span> b), d2 <span style="color:#f92672">=</span> d1 <span style="color:#f92672">+</span> rot(a <span style="color:#f92672">-</span> b);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> d3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5f</span> <span style="color:#f92672">*</span> (c <span style="color:#f92672">+</span> b), d4 <span style="color:#f92672">=</span> d3 <span style="color:#f92672">+</span> rot(c <span style="color:#f92672">-</span> b);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cross(d1, d2, d3, d4);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pii p[N];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">minCirOver</span>(<span style="color:#66d9ef">int</span> n, pii <span style="color:#f92672">&amp;</span>Center, ld <span style="color:#f92672">&amp;</span>R) {
</span></span><span style="display:flex;"><span>    Center <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>}, R <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Random
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    srand(time(<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>random_shuffle(p <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, p <span style="color:#f92672">+</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (dis(Center, p[i]) <span style="color:#f92672">&lt;=</span> R)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// i点不在圆内,说明 i要更新圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Center <span style="color:#f92672">=</span> p[i], R <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;</span> i; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (dis(Center, p[j]) <span style="color:#f92672">&lt;=</span> R)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// j不在圆内,说明 j要更新圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            Center <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5f</span> <span style="color:#f92672">*</span> (p[i] <span style="color:#f92672">+</span> p[j]), R <span style="color:#f92672">=</span> dis(Center, p[i]);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; k <span style="color:#f92672">&lt;</span> j; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (dis(Center, p[k]) <span style="color:#f92672">&lt;=</span> R)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// k不在圆内,说明 k要更新圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                Center <span style="color:#f92672">=</span> excir(p[i], p[j], p[k]), R <span style="color:#f92672">=</span> dis(Center, p[i]);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-14-最小矩形覆盖">7-14 最小矩形覆盖</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    convex(p, n);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 注意要特判只有两个点的情况
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> calc1 <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> j, <span style="color:#66d9ef">int</span> k) { <span style="color:#66d9ef">return</span> (p[j] <span style="color:#f92672">-</span> p[i]) <span style="color:#f92672">%</span> (p[k] <span style="color:#f92672">-</span> p[i]); };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> calc2 <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">int</span> j, <span style="color:#66d9ef">int</span> k) { <span style="color:#66d9ef">return</span> (p[j] <span style="color:#f92672">-</span> p[i]) <span style="color:#f92672">*</span> (p[k] <span style="color:#f92672">-</span> p[i]); };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> nt <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> i) { <span style="color:#66d9ef">return</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> n; };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, l <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">       o------j
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      /        \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     l          r
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      \         /
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        i-----o
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (sgn(calc1(i, nt(i), j) <span style="color:#f92672">-</span> calc1(i, nt(i), nt(j))) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            j <span style="color:#f92672">=</span> nt(j);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (sgn(calc2(i, nt(i), r) <span style="color:#f92672">-</span> calc2(i, nt(i), nt(r))) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">=</span> nt(r);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            l <span style="color:#f92672">=</span> r;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (sgn(calc2(i, nt(i), l) <span style="color:#f92672">-</span> calc2(i, nt(i), nt(l))) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            l <span style="color:#f92672">=</span> nt(l);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> hor <span style="color:#f92672">=</span> (p[nt(i)] <span style="color:#f92672">-</span> p[i]);
</span></span><span style="display:flex;"><span>        ld len <span style="color:#f92672">=</span> hor <span style="color:#f92672">*</span> (p[r] <span style="color:#f92672">-</span> p[l]) <span style="color:#f92672">/</span> dis(hor); <span style="color:#75715e">// --
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">auto</span> ver <span style="color:#f92672">=</span> rot(hor);
</span></span><span style="display:flex;"><span>        ld het <span style="color:#f92672">=</span> ver <span style="color:#f92672">*</span> (p[j] <span style="color:#f92672">-</span> p[i]) <span style="color:#f92672">/</span> dis(ver); <span style="color:#75715e">// |
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ans <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(ans, std<span style="color:#f92672">::</span>fabs(len <span style="color:#f92672">*</span> het));
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h2 id="7-15-圆并">7-15 圆并</h2>
<p>$O(n^2 \log n)$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>pii<span style="color:#f92672">&gt;</span> seg; <span style="color:#75715e">// 一个圆被覆盖的区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Circle</span> {
</span></span><span style="display:flex;"><span>    pii cen{<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> r{<span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">inside</span>(<span style="color:#66d9ef">const</span> Circle <span style="color:#f92672">&amp;</span>c) { <span style="color:#75715e">// 判断圆是否被c包含
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ld d <span style="color:#f92672">=</span> dis(cen, c.cen);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> sgn(r <span style="color:#f92672">+</span> d <span style="color:#f92672">-</span> c.r) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> ld <span style="color:#a6e22e">fix</span>(ld th) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (th <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> th <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (th <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> th <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi : th);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">cross</span>(<span style="color:#66d9ef">const</span> Circle <span style="color:#f92672">&amp;</span>c) { <span style="color:#75715e">// 找到c圆把自己交了哪个区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ld d <span style="color:#f92672">=</span> dis(cen, c.cen);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (sgn(d <span style="color:#f92672">-</span> r <span style="color:#f92672">-</span> c.r) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>) <span style="color:#75715e">// 没交集
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> v <span style="color:#f92672">=</span> c.cen <span style="color:#f92672">-</span> cen;
</span></span><span style="display:flex;"><span>        ld mid <span style="color:#f92672">=</span> atan2(v.y, v.x);
</span></span><span style="display:flex;"><span>        ld th <span style="color:#f92672">=</span> acos((r <span style="color:#f92672">*</span> r <span style="color:#f92672">+</span> d <span style="color:#f92672">*</span> d <span style="color:#f92672">-</span> c.r <span style="color:#f92672">*</span> c.r) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> r <span style="color:#f92672">*</span> d));
</span></span><span style="display:flex;"><span>        ld L <span style="color:#f92672">=</span> fix(mid <span style="color:#f92672">-</span> th), R <span style="color:#f92672">=</span> fix(mid <span style="color:#f92672">+</span> th);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (L <span style="color:#f92672">&lt;</span> R)
</span></span><span style="display:flex;"><span>            seg.push_back({L, R});
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            seg.push_back({<span style="color:#ae81ff">0</span>, R}), seg.push_back({L, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi});
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ld <span style="color:#a6e22e">bow</span>(<span style="color:#66d9ef">const</span> ld <span style="color:#f92672">&amp;</span>a) { <span style="color:#75715e">// 弓形面积
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">-</span> sin(a)) <span style="color:#f92672">*</span> r <span style="color:#f92672">*</span> r;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ld <span style="color:#a6e22e">edge</span>(ld L, ld R) { <span style="color:#75715e">// 边面积
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">auto</span> a <span style="color:#f92672">=</span> cen <span style="color:#f92672">+</span> (pii){r <span style="color:#f92672">*</span> cosl(L), r <span style="color:#f92672">*</span> sinl(L)};
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> b <span style="color:#f92672">=</span> cen <span style="color:#f92672">+</span> (pii){r <span style="color:#f92672">*</span> cosl(R), r <span style="color:#f92672">*</span> sinl(R)};
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">%</span> b);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ld <span style="color:#a6e22e">calc</span>() { <span style="color:#75715e">// 计算没被别的圆交的区域的面积
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ld ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        seg.push_back({<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>});
</span></span><span style="display:flex;"><span>        seg.push_back({<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> pi});
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>sort(seg.begin(), seg.end());
</span></span><span style="display:flex;"><span>        ld lim <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">auto</span> [L, R] <span style="color:#f92672">:</span> seg)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (L <span style="color:#f92672">&gt;</span> lim) {
</span></span><span style="display:flex;"><span>                ans <span style="color:#f92672">+=</span> bow(L <span style="color:#f92672">-</span> lim) <span style="color:#f92672">+</span> edge(lim, L);
</span></span><span style="display:flex;"><span>                lim <span style="color:#f92672">=</span> R;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                lim <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>max(lim, R);
</span></span><span style="display:flex;"><span>        seg.clear();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ld <span style="color:#a6e22e">CircleUnion</span>(Circle <span style="color:#f92672">*</span>c, <span style="color:#66d9ef">int</span> n) { <span style="color:#75715e">// 返回圆并面积
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) <span style="color:#75715e">// 去除被包含的圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> n; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j and c[i].inside(c[j])) {
</span></span><span style="display:flex;"><span>                c[i<span style="color:#f92672">--</span>] <span style="color:#f92672">=</span> c[<span style="color:#f92672">--</span>n];
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    ld ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> n; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j)
</span></span><span style="display:flex;"><span>                c[i].cross(c[j]); <span style="color:#75715e">// 看看j圆把i圆切了哪儿了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ans <span style="color:#f92672">+=</span> c[i].calc();  <span style="color:#75715e">// 计算i圆的贡献
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>; <span style="color:#75715e">// 之前计算的都是两倍面积
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="7-16-三维计算几何">7-16 三维计算几何</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>node <span style="color:#66d9ef">operator</span><span style="color:#f92672">%</span>(<span style="color:#66d9ef">const</span> node <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> node <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 叉乘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    node ans;
</span></span><span style="display:flex;"><span>    ans.x <span style="color:#f92672">=</span> a.y <span style="color:#f92672">*</span> b.z <span style="color:#f92672">-</span> b.y <span style="color:#f92672">*</span> a.z;
</span></span><span style="display:flex;"><span>    ans.y <span style="color:#f92672">=</span> b.x <span style="color:#f92672">*</span> a.z <span style="color:#f92672">-</span> a.x <span style="color:#f92672">*</span> b.z;
</span></span><span style="display:flex;"><span>    ans.z <span style="color:#f92672">=</span> a.x <span style="color:#f92672">*</span> b.y <span style="color:#f92672">-</span> b.x <span style="color:#f92672">*</span> a.y;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">*</span>(<span style="color:#66d9ef">const</span> node <span style="color:#f92672">&amp;</span>a, <span style="color:#66d9ef">const</span> node <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 点乘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> a.x <span style="color:#f92672">*</span> b.x <span style="color:#f92672">+</span> a.y <span style="color:#f92672">*</span> b.y <span style="color:#f92672">+</span> a.z <span style="color:#f92672">*</span> b.z;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>node <span style="color:#66d9ef">operator</span><span style="color:#f92672">*</span>(<span style="color:#66d9ef">int</span> a, node b) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 数乘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    b.x <span style="color:#f92672">*=</span> a;
</span></span><span style="display:flex;"><span>    b.y <span style="color:#f92672">*=</span> a;
</span></span><span style="display:flex;"><span>    b.z <span style="color:#f92672">*=</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> b;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">sameLine</span>(node a, node b, node c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 判断三点共线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    b <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> b <span style="color:#f92672">%</span> c <span style="color:#f92672">==</span> zero;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">samePlane</span>(node a, node b, node c, node d) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 判断三点共面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    a <span style="color:#f92672">=</span> a <span style="color:#f92672">-</span> d;
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> d;
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> d;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">%</span> b) <span style="color:#f92672">*</span> c <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="7-17-三维四点共圆">7-17 三维四点共圆</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">angle</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> dot{<span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>    node cross{<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>angle <span style="color:#a6e22e">get</span>(node a, node b, node c) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 求∠bac
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    b <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> c <span style="color:#f92672">-</span> a;
</span></span><span style="display:flex;"><span>    angle ans;
</span></span><span style="display:flex;"><span>    ans.dot <span style="color:#f92672">=</span> b <span style="color:#f92672">*</span> c;
</span></span><span style="display:flex;"><span>    ans.cross <span style="color:#f92672">=</span> b <span style="color:#f92672">%</span> c;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ans;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">sameCircle</span>(node a, node b, node c, node d) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 基于四点共面判断四点是否共圆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 其中不能出现三点共线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> ag1 <span style="color:#f92672">=</span> get(a, b, c);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> ag2 <span style="color:#f92672">=</span> get(d, c, b);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ag1.dot <span style="color:#f92672">*</span> ag2.cross <span style="color:#f92672">+</span> ag2.dot <span style="color:#f92672">*</span> ag1.cross <span style="color:#f92672">==</span> zero;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//注意仔细算算会不会爆longlong
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 也可以在基于四点共面&amp;没有三点共线的前提下用托勒密定理判
</span></span></span></code></pre></div>
              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://xiaoxiauwu.github.io/tags/c&#43;&#43;/">c&#43;&#43;</a>

  <a class="tag tag--primary tag--small" href="https://xiaoxiauwu.github.io/tags/%E6%A8%A1%E7%89%88/">模版</a>

                  </div>
                
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://xiaoxiauwu.github.io/post/first/" data-tooltip="First blog" aria-label="PREVIOUS: First blog">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            
  
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
    <script type="text/javascript">
      var disqus_config = function() {
        this.page.url = 'https:\/\/xiaoxiauwu.github.io\/post\/article_01\/';
        
          this.page.identifier = '\/post\/article_01\/'
        
      };
      (function() {
        
        
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
          document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
          return;
        }
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'hugo-tranquilpeak-theme';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 XiaoXia. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://xiaoxiauwu.github.io/post/first/" data-tooltip="First blog" aria-label="PREVIOUS: First blog">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://xiaoxiauwu.github.io/images/avatar.jpg" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">XiaoXia</h4>
    
      <div id="about-card-bio">憧憬着未来却虚度着当下，到头来自己也只是一片空虚吧<strong>LIVE IN THE MOMENT</strong></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        学生
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        华南理工大学
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://xiaoxiauwu.github.io/images/cover_.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://xiaoxiauwu.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>


  
    <script async crossorigin="anonymous" defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js"></script>
  

  
    <script src="https://xiaoxiauwu.github.io/js/click.js"></script>
  

  
    <script src="https://xiaoxiauwu.github.io/js/sakura.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

